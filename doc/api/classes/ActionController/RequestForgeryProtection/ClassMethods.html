<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>: ActionController::RequestForgeryProtection::ClassMethods [Rails Framework Documentation]</title>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
    <link href='../../../rdoc-style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='class' id='wrapper'>
      <div class='header'>
        <h1 class='name'>
          <span class='type'>Module</span>
          ActionController::RequestForgeryProtection::ClassMethods
        </h1>
        <ol class='paths'>
          <li>
            <a href="../../../files/vendor/rails/actionpack/lib/action_controller/request_forgery_protection_rb.html">vendor/rails/actionpack/lib/action_controller/request_forgery_protection.rb</a>
          </li>
        </ol>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='description'>
            <p>
            Protecting controller actions from CSRF attacks by ensuring that all forms
            are coming from the current web application, not a forged link from another
            site, is done by embedding a token based on a random string stored in the
            session (which an attacker wouldn&#8217;t know) in all forms and Ajax
            requests generated by <a href="../../Rails.html">Rails</a> and then
            verifying the authenticity of that token in the controller. Only
            HTML/JavaScript requests are checked, so this will not protect your XML API
            (presumably you&#8217;ll have a different authentication scheme there
            anyway). Also, GET requests are not protected as these should be idempotent
            anyway.
            </p>
            <p>
            This is turned on with the <tt><a
            href="ClassMethods.html#M000515">protect_from_forgery</a></tt> method,
            which will check the token and raise an
            ActionController::InvalidAuthenticityToken if it doesn&#8217;t match what
            was expected. You can customize the error message in production by editing
            public/422.html. A call to this method in ApplicationController is
            generated by default in post-<a href="../../Rails.html">Rails</a> 2.0
            applications.
            </p>
            <p>
            The token parameter is named <tt>authenticity_token</tt> by default. If you
            are generating an HTML form manually (without the use of Rails&#8217;
            <tt>form_for</tt>, <tt>form_tag</tt> or other helpers), you have to include
            a hidden field named like that and set its value to what is returned by
            <tt>form_authenticity_token</tt>. Same applies to manually constructed Ajax
            requests. To make the token available through a global variable to scripts
            on a certain page, you could add something like this to a view:
            </p>
            <pre>&lt;%= javascript_tag &quot;window._token = '#{form_authenticity_token}'&quot; %&gt;</pre>
            <p>
            <a href="../Request.html">Request</a> forgery protection is disabled by
            default in test environment. If you are upgrading from <a
            href="../../Rails.html">Rails</a> 1.x, add this to
            config/environments/test.rb:
            </p>
            <pre># Disable request forgery protection in test environment&#x000A;config.action_controller.allow_forgery_protection = false</pre>
            <h2>Learn more about CSRF (Cross-Site <a href="../Request.html">Request</a> Forgery) attacks</h2>
            <p>
            Here are some resources:
            </p>
            <ul>
            <li><a
            href="http://isc.sans.org/diary.html?storyid=1750">isc.sans.org/diary.html?storyid=1750</a>
            
            </li>
            <li><a
            href="http://en.wikipedia.org/wiki/Cross-site_request_forgery">en.wikipedia.org/wiki/Cross-site_request_forgery</a>
            
            </li>
            </ul>
            <p>
            Keep in mind, this is NOT a silver-bullet, plug &#8216;n&#8217; play, warm
            security blanket for your rails application. There are a few guidelines you
            should follow:
            </p>
            <ul>
            <li>Keep your GET requests safe and idempotent. More reading material:
            
            <ul>
            <li><a
            href="http://www.xml.com/pub/a/2002/04/24/deviant.html">www.xml.com/pub/a/2002/04/24/deviant.html</a>
            
            </li>
            <li><a
            href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html#sec9.1.1">www.w3.org/Protocols/rfc2616/rfc2616-sec9.html#sec9.1.1</a>
            
            </li>
            </ul>
            </li>
            <li>Make sure the session cookies that <a href="../../Rails.html">Rails</a>
            creates are non-persistent. Check in Firefox and look for &#8220;Expires:
            at end of session&#8220;
            
            </li>
            </ul>
          </div>
          <div id='method-list'>
            <h2>Methods</h2>
            <h3>public instance</h3>
            <ol>
              <li><a href="#M000515">protect_from_forgery</a></li>
            </ol>
          </div>
          <div id='section'>
            <div id='methods'>
              <h2>Public instance methods</h2>
              <div class='method public-instance' id='method-M000515'>
                <a name='M000515'></a>
                <div class='synopsis'>
                  <span class='name'>protect_from_forgery</span>
                  <span class='arguments'>(options = {})</span>
                </div>
                <div class='description'>
                  <p>
                  Turn on request forgery protection. Bear in mind that only non-GET,
                  HTML/JavaScript requests are checked.
                  </p>
                  <p>
                  Example:
                  </p>
                  <pre>class FooController &lt; ApplicationController&#x000A;  protect_from_forgery :except =&gt; :index&#x000A;&#x000A;  # you can disable csrf protection on controller-by-controller basis:&#x000A;  skip_before_filter :verify_authenticity_token&#x000A;end</pre>
                  <p>
                  Valid Options:
                  </p>
                  <ul>
                  <li><tt>:only/:except</tt> - Passed to the <tt>before_filter</tt> call. Set
                  which actions are verified.
                  
                  </li>
                  </ul>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000515-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000515-source'>    <span class="ruby-comment cmt"># File vendor/rails/actionpack/lib/action_controller/request_forgery_protection.rb, line 67</span>&#x000A;67:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">protect_from_forgery</span>(<span class="ruby-identifier">options</span> = {})&#x000A;68:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">request_forgery_protection_token</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">:authenticity_token</span>&#x000A;69:         <span class="ruby-identifier">before_filter</span> <span class="ruby-identifier">:verify_authenticity_token</span>, <span class="ruby-identifier">:only</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:only</span>), <span class="ruby-identifier">:except</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:except</span>)&#x000A;70:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:secret</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:digest</span>]&#x000A;71:           <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">Deprecation</span>.<span class="ruby-identifier">warn</span>(<span class="ruby-value str">&quot;protect_from_forgery only takes :only and :except options now. :digest and :secret have no effect&quot;</span>, <span class="ruby-identifier">caller</span>)&#x000A;72:         <span class="ruby-keyword kw">end</span>&#x000A;73:       <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
