<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>: ActionController::Assertions::RoutingAssertions [Rails Framework Documentation]</title>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
    <link href='../../../rdoc-style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='class' id='wrapper'>
      <div class='header'>
        <h1 class='name'>
          <span class='type'>Module</span>
          ActionController::Assertions::RoutingAssertions
        </h1>
        <ol class='paths'>
          <li>
            <a href="../../../files/vendor/rails/actionpack/lib/action_controller/assertions/routing_assertions_rb.html">vendor/rails/actionpack/lib/action_controller/assertions/routing_assertions.rb</a>
          </li>
        </ol>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='description'>
            <p>
            Suite of assertions to test routes generated by <a
            href="../../Rails.html">Rails</a> and the handling of requests made to
            them.
            </p>
          </div>
          <div id='method-list'>
            <h2>Methods</h2>
            <h3>public instance</h3>
            <ol>
              <li><a href="#M000577">assert_generates</a></li>
              <li><a href="#M000576">assert_recognizes</a></li>
              <li><a href="#M000578">assert_routing</a></li>
            </ol>
          </div>
          <div id='section'>
            <div id='methods'>
              <h2>Public instance methods</h2>
              <div class='method public-instance' id='method-M000577'>
                <a name='M000577'></a>
                <div class='synopsis'>
                  <span class='name'>assert_generates</span>
                  <span class='arguments'>(expected_path, options, defaults={}, extras = {}, message=nil)</span>
                </div>
                <div class='description'>
                  <p>
                  Asserts that the provided options can be used to generate the provided
                  path. This is the inverse of <tt><a
                  href="RoutingAssertions.html#M000576">assert_recognizes</a></tt>. The
                  <tt>extras</tt> parameter is used to tell the request the names and values
                  of additional request parameters that would be in a query string. The
                  <tt>message</tt> parameter allows you to specify a custom error message for
                  assertion failures.
                  </p>
                  <p>
                  The <tt>defaults</tt> parameter is unused.
                  </p>
                  <h4>Examples</h4>
                  <pre># Asserts that the default action is generated for a route with no action&#x000A;assert_generates &quot;/items&quot;, :controller =&gt; &quot;items&quot;, :action =&gt; &quot;index&quot;&#x000A;&#x000A;# Tests that the list action is properly routed&#x000A;assert_generates &quot;/items/list&quot;, :controller =&gt; &quot;items&quot;, :action =&gt; &quot;list&quot;&#x000A;&#x000A;# Tests the generation of a route with a parameter&#x000A;assert_generates &quot;/items/list/1&quot;, { :controller =&gt; &quot;items&quot;, :action =&gt; &quot;list&quot;, :id =&gt; &quot;1&quot; }&#x000A;&#x000A;# Asserts that the generated route gives us our custom route&#x000A;assert_generates &quot;changesets/12&quot;, { :controller =&gt; 'scm', :action =&gt; 'show_diff', :revision =&gt; &quot;12&quot; }</pre>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000577-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000577-source'>    <span class="ruby-comment cmt"># File vendor/rails/actionpack/lib/action_controller/assertions/routing_assertions.rb, line 80</span>&#x000A;80:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">assert_generates</span>(<span class="ruby-identifier">expected_path</span>, <span class="ruby-identifier">options</span>, <span class="ruby-identifier">defaults</span>={}, <span class="ruby-identifier">extras</span> = {}, <span class="ruby-identifier">message</span>=<span class="ruby-keyword kw">nil</span>)&#x000A;81:         <span class="ruby-identifier">clean_backtrace</span> <span class="ruby-keyword kw">do</span>&#x000A;82:           <span class="ruby-identifier">expected_path</span> = <span class="ruby-node">&quot;/#{expected_path}&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">expected_path</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-value">?/</span>&#x000A;83:           <span class="ruby-comment cmt"># Load routes.rb if it hasn't been loaded.</span>&#x000A;84:           <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">Routing</span><span class="ruby-operator">::</span><span class="ruby-constant">Routes</span>.<span class="ruby-identifier">reload</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">Routing</span><span class="ruby-operator">::</span><span class="ruby-constant">Routes</span>.<span class="ruby-identifier">empty?</span>&#x000A;85: &#x000A;86:           <span class="ruby-identifier">generated_path</span>, <span class="ruby-identifier">extra_keys</span> = <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">Routing</span><span class="ruby-operator">::</span><span class="ruby-constant">Routes</span>.<span class="ruby-identifier">generate_extras</span>(<span class="ruby-identifier">options</span>, <span class="ruby-identifier">defaults</span>)&#x000A;87:           <span class="ruby-identifier">found_extras</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">reject</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-operator">!</span> <span class="ruby-identifier">extra_keys</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">k</span>}&#x000A;88: &#x000A;89:           <span class="ruby-identifier">msg</span> = <span class="ruby-identifier">build_message</span>(<span class="ruby-identifier">message</span>, <span class="ruby-value str">&quot;found extras &lt;?&gt;, not &lt;?&gt;&quot;</span>, <span class="ruby-identifier">found_extras</span>, <span class="ruby-identifier">extras</span>)&#x000A;90:           <span class="ruby-identifier">assert_block</span>(<span class="ruby-identifier">msg</span>) { <span class="ruby-identifier">found_extras</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">extras</span> }&#x000A;91: &#x000A;92:           <span class="ruby-identifier">msg</span> = <span class="ruby-identifier">build_message</span>(<span class="ruby-identifier">message</span>, <span class="ruby-value str">&quot;The generated path &lt;?&gt; did not match &lt;?&gt;&quot;</span>, <span class="ruby-identifier">generated_path</span>,&#x000A;93:               <span class="ruby-identifier">expected_path</span>)&#x000A;94:           <span class="ruby-identifier">assert_block</span>(<span class="ruby-identifier">msg</span>) { <span class="ruby-identifier">expected_path</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">generated_path</span> }&#x000A;95:         <span class="ruby-keyword kw">end</span>&#x000A;96:       <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000576'>
                <a name='M000576'></a>
                <div class='synopsis'>
                  <span class='name'>assert_recognizes</span>
                  <span class='arguments'>(expected_options, path, extras={}, message=nil)</span>
                </div>
                <div class='description'>
                  <p>
                  Asserts that the routing of the given <tt>path</tt> was handled correctly
                  and that the parsed options (given in the <tt>expected_options</tt> hash)
                  match <tt>path</tt>. Basically, it asserts that <a
                  href="../../Rails.html">Rails</a> recognizes the route given by
                  <tt>expected_options</tt>.
                  </p>
                  <p>
                  Pass a hash in the second argument (<tt>path</tt>) to specify the request
                  method. This is useful for routes requiring a specific HTTP method. The
                  hash should contain a :path with the incoming request path and a :method
                  containing the required HTTP verb.
                  </p>
                  <pre># assert that POSTing to /items will call the create action on ItemsController&#x000A;assert_recognizes {:controller =&gt; 'items', :action =&gt; 'create'}, {:path =&gt; 'items', :method =&gt; :post}</pre>
                  <p>
                  You can also pass in <tt>extras</tt> with a hash containing URL parameters
                  that would normally be in the query string. This can be used to assert that
                  values in the query string string will end up in the params hash correctly.
                  To test query strings you must use the extras argument, appending the query
                  string on the path directly will not work. For example:
                  </p>
                  <pre># assert that a path of '/items/list/1?view=print' returns the correct options&#x000A;assert_recognizes {:controller =&gt; 'items', :action =&gt; 'list', :id =&gt; '1', :view =&gt; 'print'}, 'items/list/1', { :view =&gt; &quot;print&quot; }</pre>
                  <p>
                  The <tt>message</tt> parameter allows you to pass in an error message that
                  is displayed upon failure.
                  </p>
                  <h4>Examples</h4>
                  <pre># Check the default route (i.e., the index action)&#x000A;assert_recognizes {:controller =&gt; 'items', :action =&gt; 'index'}, 'items'&#x000A;&#x000A;# Test a specific action&#x000A;assert_recognizes {:controller =&gt; 'items', :action =&gt; 'list'}, 'items/list'&#x000A;&#x000A;# Test an action with a parameter&#x000A;assert_recognizes {:controller =&gt; 'items', :action =&gt; 'destroy', :id =&gt; '1'}, 'items/destroy/1'&#x000A;&#x000A;# Test a custom route&#x000A;assert_recognizes {:controller =&gt; 'items', :action =&gt; 'show', :id =&gt; '1'}, 'view/item1'&#x000A;&#x000A;# Check a Simply RESTful generated route&#x000A;assert_recognizes list_items_url, 'items/list'</pre>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000576-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000576-source'>    <span class="ruby-comment cmt"># File vendor/rails/actionpack/lib/action_controller/assertions/routing_assertions.rb, line 39</span>&#x000A;39:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">assert_recognizes</span>(<span class="ruby-identifier">expected_options</span>, <span class="ruby-identifier">path</span>, <span class="ruby-identifier">extras</span>={}, <span class="ruby-identifier">message</span>=<span class="ruby-keyword kw">nil</span>)&#x000A;40:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">path</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Hash</span>&#x000A;41:           <span class="ruby-identifier">request_method</span> = <span class="ruby-identifier">path</span>[<span class="ruby-identifier">:method</span>]&#x000A;42:           <span class="ruby-identifier">path</span>           = <span class="ruby-identifier">path</span>[<span class="ruby-identifier">:path</span>]&#x000A;43:         <span class="ruby-keyword kw">else</span>&#x000A;44:           <span class="ruby-identifier">request_method</span> = <span class="ruby-keyword kw">nil</span>&#x000A;45:         <span class="ruby-keyword kw">end</span>&#x000A;46: &#x000A;47:         <span class="ruby-identifier">clean_backtrace</span> <span class="ruby-keyword kw">do</span>&#x000A;48:           <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">Routing</span><span class="ruby-operator">::</span><span class="ruby-constant">Routes</span>.<span class="ruby-identifier">reload</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">Routing</span><span class="ruby-operator">::</span><span class="ruby-constant">Routes</span>.<span class="ruby-identifier">empty?</span>&#x000A;49:           <span class="ruby-identifier">request</span> = <span class="ruby-identifier">recognized_request_for</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">request_method</span>)&#x000A;50: &#x000A;51:           <span class="ruby-identifier">expected_options</span> = <span class="ruby-identifier">expected_options</span>.<span class="ruby-identifier">clone</span>&#x000A;52:           <span class="ruby-identifier">extras</span>.<span class="ruby-identifier">each_key</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span> <span class="ruby-identifier">expected_options</span>.<span class="ruby-identifier">delete</span> <span class="ruby-identifier">key</span> } <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">extras</span>.<span class="ruby-identifier">nil?</span>&#x000A;53: &#x000A;54:           <span class="ruby-identifier">expected_options</span>.<span class="ruby-identifier">stringify_keys!</span>&#x000A;55:           <span class="ruby-identifier">routing_diff</span> = <span class="ruby-identifier">expected_options</span>.<span class="ruby-identifier">diff</span>(<span class="ruby-identifier">request</span>.<span class="ruby-identifier">path_parameters</span>)&#x000A;56:           <span class="ruby-identifier">msg</span> = <span class="ruby-identifier">build_message</span>(<span class="ruby-identifier">message</span>, <span class="ruby-value str">&quot;The recognized options &lt;?&gt; did not match &lt;?&gt;, difference: &lt;?&gt;&quot;</span>,&#x000A;57:               <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path_parameters</span>, <span class="ruby-identifier">expected_options</span>, <span class="ruby-identifier">expected_options</span>.<span class="ruby-identifier">diff</span>(<span class="ruby-identifier">request</span>.<span class="ruby-identifier">path_parameters</span>))&#x000A;58:           <span class="ruby-identifier">assert_block</span>(<span class="ruby-identifier">msg</span>) { <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path_parameters</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">expected_options</span> }&#x000A;59:         <span class="ruby-keyword kw">end</span>&#x000A;60:       <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000578'>
                <a name='M000578'></a>
                <div class='synopsis'>
                  <span class='name'>assert_routing</span>
                  <span class='arguments'>(path, options, defaults={}, extras={}, message=nil)</span>
                </div>
                <div class='description'>
                  <p>
                  Asserts that path and options match both ways; in other words, it verifies
                  that <tt>path</tt> generates <tt>options</tt> and then that
                  <tt>options</tt> generates <tt>path</tt>. This essentially combines <tt><a
                  href="RoutingAssertions.html#M000576">assert_recognizes</a></tt> and <tt><a
                  href="RoutingAssertions.html#M000577">assert_generates</a></tt> into one
                  step.
                  </p>
                  <p>
                  The <tt>extras</tt> hash allows you to specify options that would normally
                  be provided as a query string to the action. The <tt>message</tt> parameter
                  allows you to specify a custom error message to display upon failure.
                  </p>
                  <h4>Examples</h4>
                  <pre># Assert a basic route: a controller with the default action (index)&#x000A;assert_routing '/home', :controller =&gt; 'home', :action =&gt; 'index'&#x000A;&#x000A;# Test a route generated with a specific controller, action, and parameter (id)&#x000A;assert_routing '/entries/show/23', :controller =&gt; 'entries', :action =&gt; 'show', id =&gt; 23&#x000A;&#x000A;# Assert a basic route (controller + default action), with an error message if it fails&#x000A;assert_routing '/store', { :controller =&gt; 'store', :action =&gt; 'index' }, {}, {}, 'Route for store index not generated properly'&#x000A;&#x000A;# Tests a route, providing a defaults hash&#x000A;assert_routing 'controller/action/9', {:id =&gt; &quot;9&quot;, :item =&gt; &quot;square&quot;}, {:controller =&gt; &quot;controller&quot;, :action =&gt; &quot;action&quot;}, {}, {:item =&gt; &quot;square&quot;}&#x000A;&#x000A;# Tests a route with a HTTP method&#x000A;assert_routing { :method =&gt; 'put', :path =&gt; '/product/321' }, { :controller =&gt; &quot;product&quot;, :action =&gt; &quot;update&quot;, :id =&gt; &quot;321&quot; }</pre>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000578-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000578-source'>     <span class="ruby-comment cmt"># File vendor/rails/actionpack/lib/action_controller/assertions/routing_assertions.rb, line 120</span>&#x000A;120:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">assert_routing</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">options</span>, <span class="ruby-identifier">defaults</span>={}, <span class="ruby-identifier">extras</span>={}, <span class="ruby-identifier">message</span>=<span class="ruby-keyword kw">nil</span>)&#x000A;121:         <span class="ruby-identifier">assert_recognizes</span>(<span class="ruby-identifier">options</span>, <span class="ruby-identifier">path</span>, <span class="ruby-identifier">extras</span>, <span class="ruby-identifier">message</span>)&#x000A;122: &#x000A;123:         <span class="ruby-identifier">controller</span>, <span class="ruby-identifier">default_controller</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:controller</span>], <span class="ruby-identifier">defaults</span>[<span class="ruby-identifier">:controller</span>]&#x000A;124:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">controller</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">controller</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value">?/</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">default_controller</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">default_controller</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value">?/</span>)&#x000A;125:           <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:controller</span>] = <span class="ruby-node">&quot;/#{controller}&quot;</span>&#x000A;126:         <span class="ruby-keyword kw">end</span>&#x000A;127: &#x000A;128:         <span class="ruby-identifier">assert_generates</span>(<span class="ruby-identifier">path</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">path</span>[<span class="ruby-identifier">:path</span>] <span class="ruby-operator">:</span> <span class="ruby-identifier">path</span>, <span class="ruby-identifier">options</span>, <span class="ruby-identifier">defaults</span>, <span class="ruby-identifier">extras</span>, <span class="ruby-identifier">message</span>)&#x000A;129:       <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
