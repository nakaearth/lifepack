<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>: MemCache [Rails Framework Documentation]</title>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
    <link href='../rdoc-style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='class' id='wrapper'>
      <div class='header'>
        <h1 class='name'>
          <span class='type'>Class</span>
          MemCache
        </h1>
        <ol class='paths'>
          <li>
            <a href="../files/vendor/rails/activesupport/lib/active_support/vendor/memcache-client-1_6_5/memcache_rb.html">vendor/rails/activesupport/lib/active_support/vendor/memcache-client-1.6.5/memcache.rb</a>
          </li>
        </ol>
        <div class='parent'>
          Parent:
          <strong><a href="Object.html">Object</a></strong>
        </div>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='description'>
            <p>
            A Ruby client library for memcached.
            </p>
          </div>
          <div id='method-list'>
            <h2>Methods</h2>
            <h3>public class</h3>
            <ol>
              <li><a href="#M000120">new</a></li>
            </ol>
            <h3>public instance</h3>
            <ol>
              <li><a href="#M000135">[]</a></li>
              <li><a href="#M000136">[]=</a></li>
              <li><a href="#M000122">active?</a></li>
              <li><a href="#M000130">add</a></li>
              <li><a href="#M000125">decr</a></li>
              <li><a href="#M000131">delete</a></li>
              <li><a href="#M000132">flush_all</a></li>
              <li><a href="#M000126">get</a></li>
              <li><a href="#M000127">get_multi</a></li>
              <li><a href="#M000128">incr</a></li>
              <li><a href="#M000121">inspect</a></li>
              <li><a href="#M000123">readonly?</a></li>
              <li><a href="#M000133">reset</a></li>
              <li><a href="#M000124">servers=</a></li>
              <li><a href="#M000129">set</a></li>
              <li><a href="#M000134">stats</a></li>
            </ol>
            <h3>protected instance</h3>
            <ol>
              <li><a href="#M000140">cache_decr</a></li>
              <li><a href="#M000141">cache_get</a></li>
              <li><a href="#M000142">cache_get_multi</a></li>
              <li><a href="#M000143">cache_incr</a></li>
              <li><a href="#M000151">check_multithread_status!</a></li>
              <li><a href="#M000149">create_continuum_for</a></li>
              <li><a href="#M000150">entry_count_for</a></li>
              <li><a href="#M000139">get_server_for_key</a></li>
              <li><a href="#M000146">handle_error</a></li>
              <li><a href="#M000138">hash_for</a></li>
              <li><a href="#M000137">make_cache_key</a></li>
              <li><a href="#M000148">raise_on_error_response!</a></li>
              <li><a href="#M000147">request_setup</a></li>
              <li><a href="#M000145">with_server</a></li>
              <li><a href="#M000144">with_socket_management</a></li>
            </ol>
          </div>
          <div id='section'>
            <div id='class-list'>
              <h2>Classes and Modules</h2>
              Class <a href="MemCache/MemCacheError.html" class="link">MemCache::MemCacheError</a><br />
              Class <a href="MemCache/Server.html" class="link">MemCache::Server</a><br />
            </div>
            <div id='constants-list'>
              <h2>Constants</h2>
              <div class='name-list'>
                <table summary='Constants'>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>VERSION</td>
                    <td>=</td>
                    <td class='context-item-value'>'1.6.4.99'</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'>
                      
                      The version of <a href="MemCache.html">MemCache</a> you are using.
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>DEFAULT_OPTIONS</td>
                    <td>=</td>
                    <td class='context-item-value'>{     :namespace   =&gt; nil,     :readonly    =&gt; false,     :multithread =&gt; true,     :failover    =&gt; true,     :timeout     =&gt; 0.5,     :logger      =&gt; nil,   }</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'>
                      
                      Default options for the cache object.
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>DEFAULT_PORT</td>
                    <td>=</td>
                    <td class='context-item-value'>11211</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'>
                      
                      Default memcached port.
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>DEFAULT_WEIGHT</td>
                    <td>=</td>
                    <td class='context-item-value'>1</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'>
                      
                      Default memcached server weight.
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>ONE_MB</td>
                    <td>=</td>
                    <td class='context-item-value'>1024 * 1024</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'>
                      
                      Add <tt>key</tt> to the cache with value <tt>value</tt> that expires in
                      <tt>expiry</tt> seconds. If <tt>raw</tt> is true, <tt>value</tt> will not
                      be Marshalled.
                      
                      <p>
                      Warning: Readers should not call this method in the event of a cache miss;
                      see <a href="MemCache.html#M000130">MemCache#add</a>.
                      </p>
                    </td>
                  </tr>
                </table>
              </div>
            </div>
            <div id='attribute-list'>
              <h2 class='section-bar'>Attributes</h2>
              <div class='name-list'>
                <table>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>failover</td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      Should the client try to failover to another server if the first server is
                      down? Defaults to true.
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>logger</td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      Log debug/info/warn/error to the given <a href="Logger.html">Logger</a>,
                      defaults to nil.
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>multithread</td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      The multithread setting for this instance
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>namespace</td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      The namespace for this instance
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>servers</td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      The servers this client talks to. Play at your own peril.
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>timeout</td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      Socket timeout limit with this client, defaults to 0.5 sec. Set to nil to
                      disable timeouts.
                    </td>
                  </tr>
                </table>
              </div>
            </div>
            <div id='methods'>
              <h2>Public class methods</h2>
              <div class='method public-class' id='method-M000120'>
                <a name='M000120'></a>
                <div class='synopsis'>
                  <span class='name'>new</span>
                  <span class='arguments'>(*args)</span>
                </div>
                <div class='description'>
                  <p>
                  Accepts a list of <tt>servers</tt> and a list of <tt>opts</tt>.
                  <tt>servers</tt> may be omitted. See <tt>servers=</tt> for acceptable
                  server list arguments.
                  </p>
                  <p>
                  Valid options for <tt>opts</tt> are:
                  </p>
                  <pre>[:namespace]   Prepends this value to all keys added or retrieved.&#x000A;[:readonly]    Raises an exception on cache writes when true.&#x000A;[:multithread] Wraps cache access in a Mutex for thread safety.&#x000A;[:failover]    Should the client try to failover to another server if the&#x000A;               first server is down?  Defaults to true.&#x000A;[:timeout]     Time to use as the socket read timeout.  Defaults to 0.5 sec,&#x000A;               set to nil to disable timeouts (this is a major performance penalty in Ruby 1.8).&#x000A;[:logger]      Logger to use for info/debug output, defaults to nil</pre>
                  <p>
                  Other options are ignored.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000120-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000120-source'>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/vendor/memcache-client-1.6.5/memcache.rb, line 90</span>&#x000A; 90:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)&#x000A; 91:     <span class="ruby-identifier">servers</span> = []&#x000A; 92:     <span class="ruby-identifier">opts</span> = {}&#x000A; 93: &#x000A; 94:     <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">length</span>&#x000A; 95:     <span class="ruby-keyword kw">when</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">then</span> <span class="ruby-comment cmt"># NOP</span>&#x000A; 96:     <span class="ruby-keyword kw">when</span> <span class="ruby-value">1</span> <span class="ruby-keyword kw">then</span>&#x000A; 97:       <span class="ruby-identifier">arg</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span>&#x000A; 98:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">arg</span>&#x000A; 99:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Hash</span>   <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">opts</span> = <span class="ruby-identifier">arg</span>&#x000A;100:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Array</span>  <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">servers</span> = <span class="ruby-identifier">arg</span>&#x000A;101:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">String</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">servers</span> = [<span class="ruby-identifier">arg</span>]&#x000A;102:       <span class="ruby-keyword kw">else</span> <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-value str">'first argument must be Array, Hash or String'</span>&#x000A;103:       <span class="ruby-keyword kw">end</span>&#x000A;104:     <span class="ruby-keyword kw">when</span> <span class="ruby-value">2</span> <span class="ruby-keyword kw">then</span>&#x000A;105:       <span class="ruby-identifier">servers</span>, <span class="ruby-identifier">opts</span> = <span class="ruby-identifier">args</span>&#x000A;106:     <span class="ruby-keyword kw">else</span>&#x000A;107:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;wrong number of arguments (#{args.length} for 2)&quot;</span>&#x000A;108:     <span class="ruby-keyword kw">end</span>&#x000A;109: &#x000A;110:     <span class="ruby-identifier">opts</span> = <span class="ruby-constant">DEFAULT_OPTIONS</span>.<span class="ruby-identifier">merge</span> <span class="ruby-identifier">opts</span>&#x000A;111:     <span class="ruby-ivar">@namespace</span>   = <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:namespace</span>]&#x000A;112:     <span class="ruby-ivar">@readonly</span>    = <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:readonly</span>]&#x000A;113:     <span class="ruby-ivar">@multithread</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:multithread</span>]&#x000A;114:     <span class="ruby-ivar">@timeout</span>     = <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:timeout</span>]&#x000A;115:     <span class="ruby-ivar">@failover</span>    = <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:failover</span>]&#x000A;116:     <span class="ruby-ivar">@logger</span>      = <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:logger</span>]&#x000A;117:     <span class="ruby-ivar">@mutex</span>       = <span class="ruby-constant">Mutex</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@multithread</span>&#x000A;118: &#x000A;119:     <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> { <span class="ruby-node">&quot;memcache-client #{VERSION} #{Array(servers).inspect}&quot;</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">logger</span>&#x000A;120: &#x000A;121:     <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>[<span class="ruby-identifier">:memcache_client</span>] = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">object_id</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@multithread</span>&#x000A;122: &#x000A;123:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">servers</span> = <span class="ruby-identifier">servers</span>&#x000A;124:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <h2>Public instance methods</h2>
              <div class='method public-instance' id='method-M000135'>
                <a name='M000135'></a>
                <div class='synopsis'>
                  <span class='name'>[]</span>
                  <span class='arguments'>(key, raw = false)</span>
                </div>
                <div class='description'>
                  <p>
                  Alias for <a href="MemCache.html#M000126">get</a>
                  </p>
                </div>
              </div>
              <div class='method public-instance' id='method-M000136'>
                <a name='M000136'></a>
                <div class='synopsis'>
                  <span class='name'>[]=</span>
                  <span class='arguments'>(key, value)</span>
                </div>
                <div class='description'>
                  <p>
                  Shortcut to save a value in the cache. This method does not set an
                  expiration on the entry. Use set to specify an explicit expiry.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000136-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000136-source'>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/vendor/memcache-client-1.6.5/memcache.rb, line 458</span>&#x000A;458:   <span class="ruby-keyword kw">def</span> <span class="ruby-operator">[]=</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span>)&#x000A;459:     <span class="ruby-identifier">set</span> <span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span>&#x000A;460:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000122'>
                <a name='M000122'></a>
                <div class='synopsis'>
                  <span class='name'>active?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Returns whether there is at least one active server for the object.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000122-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000122-source'>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/vendor/memcache-client-1.6.5/memcache.rb, line 137</span>&#x000A;137:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">active?</span>&#x000A;138:     <span class="ruby-keyword kw">not</span> <span class="ruby-ivar">@servers</span>.<span class="ruby-identifier">empty?</span>&#x000A;139:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000130'>
                <a name='M000130'></a>
                <div class='synopsis'>
                  <span class='name'>add</span>
                  <span class='arguments'>(key, value, expiry = 0, raw = false)</span>
                </div>
                <div class='description'>
                  <p>
                  Add <tt>key</tt> to the cache with value <tt>value</tt> that expires in
                  <tt>expiry</tt> seconds, but only if <tt>key</tt> does not already exist in
                  the cache. If <tt>raw</tt> is true, <tt>value</tt> will not be Marshalled.
                  </p>
                  <p>
                  Readers should call this method in the event of a cache miss, not <a
                  href="MemCache.html#M000129">MemCache#set</a> or MemCache#[]=.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000130-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000130-source'>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/vendor/memcache-client-1.6.5/memcache.rb, line 316</span>&#x000A;316:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span>, <span class="ruby-identifier">expiry</span> = <span class="ruby-value">0</span>, <span class="ruby-identifier">raw</span> = <span class="ruby-keyword kw">false</span>)&#x000A;317:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-value str">&quot;Update of readonly cache&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@readonly</span>&#x000A;318:     <span class="ruby-identifier">with_server</span>(<span class="ruby-identifier">key</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">server</span>, <span class="ruby-identifier">cache_key</span><span class="ruby-operator">|</span>&#x000A;319:       <span class="ruby-identifier">value</span> = <span class="ruby-constant">Marshal</span>.<span class="ruby-identifier">dump</span> <span class="ruby-identifier">value</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">raw</span>&#x000A;320:       <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> { <span class="ruby-node">&quot;ADD #{key} to #{server}: #{value ? value.to_s.size : 'nil'}&quot;</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">logger</span>&#x000A;321:       <span class="ruby-identifier">command</span> = <span class="ruby-node">&quot;add #{cache_key} 0 #{expiry} #{value.to_s.size}\r\n#{value}\r\n&quot;</span>&#x000A;322: &#x000A;323:       <span class="ruby-identifier">with_socket_management</span>(<span class="ruby-identifier">server</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">socket</span><span class="ruby-operator">|</span>&#x000A;324:         <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">command</span>&#x000A;325:         <span class="ruby-identifier">result</span> = <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">gets</span>&#x000A;326:         <span class="ruby-identifier">raise_on_error_response!</span> <span class="ruby-identifier">result</span>&#x000A;327:         <span class="ruby-identifier">result</span>&#x000A;328:       <span class="ruby-keyword kw">end</span>&#x000A;329:     <span class="ruby-keyword kw">end</span>&#x000A;330:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000125'>
                <a name='M000125'></a>
                <div class='synopsis'>
                  <span class='name'>decr</span>
                  <span class='arguments'>(key, amount = 1)</span>
                </div>
                <div class='description'>
                  <p>
                  Decrements the value for <tt>key</tt> by <tt>amount</tt> and returns the
                  new value. <tt>key</tt> must already exist. If <tt>key</tt> is not an
                  integer, it is assumed to be
                  </p>
                  <ol>
                  <li><tt>key</tt> can not be decremented below 0.
                  
                  </li>
                  </ol>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000125-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000125-source'>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/vendor/memcache-client-1.6.5/memcache.rb, line 180</span>&#x000A;180:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">decr</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">amount</span> = <span class="ruby-value">1</span>)&#x000A;181:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-value str">&quot;Update of readonly cache&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@readonly</span>&#x000A;182:     <span class="ruby-identifier">with_server</span>(<span class="ruby-identifier">key</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">server</span>, <span class="ruby-identifier">cache_key</span><span class="ruby-operator">|</span>&#x000A;183:       <span class="ruby-identifier">cache_decr</span> <span class="ruby-identifier">server</span>, <span class="ruby-identifier">cache_key</span>, <span class="ruby-identifier">amount</span>&#x000A;184:     <span class="ruby-keyword kw">end</span>&#x000A;185:   <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">TypeError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">err</span>&#x000A;186:     <span class="ruby-identifier">handle_error</span> <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">err</span>&#x000A;187:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000131'>
                <a name='M000131'></a>
                <div class='synopsis'>
                  <span class='name'>delete</span>
                  <span class='arguments'>(key, expiry = 0)</span>
                </div>
                <div class='description'>
                  <p>
                  Removes <tt>key</tt> from the cache in <tt>expiry</tt> seconds.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000131-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000131-source'>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/vendor/memcache-client-1.6.5/memcache.rb, line 335</span>&#x000A;335:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">expiry</span> = <span class="ruby-value">0</span>)&#x000A;336:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-value str">&quot;Update of readonly cache&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@readonly</span>&#x000A;337:     <span class="ruby-identifier">with_server</span>(<span class="ruby-identifier">key</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">server</span>, <span class="ruby-identifier">cache_key</span><span class="ruby-operator">|</span>&#x000A;338:       <span class="ruby-identifier">with_socket_management</span>(<span class="ruby-identifier">server</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">socket</span><span class="ruby-operator">|</span>&#x000A;339:         <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">write</span> <span class="ruby-node">&quot;delete #{cache_key} #{expiry}\r\n&quot;</span>&#x000A;340:         <span class="ruby-identifier">result</span> = <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">gets</span>&#x000A;341:         <span class="ruby-identifier">raise_on_error_response!</span> <span class="ruby-identifier">result</span>&#x000A;342:         <span class="ruby-identifier">result</span>&#x000A;343:       <span class="ruby-keyword kw">end</span>&#x000A;344:     <span class="ruby-keyword kw">end</span>&#x000A;345:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000132'>
                <a name='M000132'></a>
                <div class='synopsis'>
                  <span class='name'>flush_all</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Flush the cache from all memcache servers.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000132-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000132-source'>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/vendor/memcache-client-1.6.5/memcache.rb, line 350</span>&#x000A;350:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">flush_all</span>&#x000A;351:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-value str">'No active servers'</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">active?</span>&#x000A;352:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-value str">&quot;Update of readonly cache&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@readonly</span>&#x000A;353: &#x000A;354:     <span class="ruby-keyword kw">begin</span>&#x000A;355:       <span class="ruby-ivar">@servers</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">server</span><span class="ruby-operator">|</span>&#x000A;356:         <span class="ruby-identifier">with_socket_management</span>(<span class="ruby-identifier">server</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">socket</span><span class="ruby-operator">|</span>&#x000A;357:           <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">write</span> <span class="ruby-value str">&quot;flush_all\r\n&quot;</span>&#x000A;358:           <span class="ruby-identifier">result</span> = <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">gets</span>&#x000A;359:           <span class="ruby-identifier">raise_on_error_response!</span> <span class="ruby-identifier">result</span>&#x000A;360:           <span class="ruby-identifier">result</span>&#x000A;361:         <span class="ruby-keyword kw">end</span>&#x000A;362:       <span class="ruby-keyword kw">end</span>&#x000A;363:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">IndexError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">err</span>&#x000A;364:       <span class="ruby-identifier">handle_error</span> <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">err</span>&#x000A;365:     <span class="ruby-keyword kw">end</span>&#x000A;366:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000126'>
                <a name='M000126'></a>
                <div class='synopsis'>
                  <span class='name'>get</span>
                  <span class='arguments'>(key, raw = false)</span>
                </div>
                <div class='description'>
                  <p>
                  Retrieves <tt>key</tt> from memcache. If <tt>raw</tt> is false, the value
                  will be unmarshalled.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000126-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000126-source'>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/vendor/memcache-client-1.6.5/memcache.rb, line 193</span>&#x000A;193:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">raw</span> = <span class="ruby-keyword kw">false</span>)&#x000A;194:     <span class="ruby-identifier">with_server</span>(<span class="ruby-identifier">key</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">server</span>, <span class="ruby-identifier">cache_key</span><span class="ruby-operator">|</span>&#x000A;195:       <span class="ruby-identifier">value</span> = <span class="ruby-identifier">cache_get</span> <span class="ruby-identifier">server</span>, <span class="ruby-identifier">cache_key</span>&#x000A;196:       <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> { <span class="ruby-node">&quot;GET #{key} from #{server.inspect}: #{value ? value.to_s.size : 'nil'}&quot;</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">logger</span>&#x000A;197:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">nil?</span>&#x000A;198:       <span class="ruby-identifier">value</span> = <span class="ruby-constant">Marshal</span>.<span class="ruby-identifier">load</span> <span class="ruby-identifier">value</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">raw</span>&#x000A;199:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">value</span>&#x000A;200:     <span class="ruby-keyword kw">end</span>&#x000A;201:   <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">TypeError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">err</span>&#x000A;202:     <span class="ruby-identifier">handle_error</span> <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">err</span>&#x000A;203:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000127'>
                <a name='M000127'></a>
                <div class='synopsis'>
                  <span class='name'>get_multi</span>
                  <span class='arguments'>(*keys)</span>
                </div>
                <div class='description'>
                  <p>
                  Retrieves multiple values from memcached in parallel, if possible.
                  </p>
                  <p>
                  The memcached protocol supports the ability to retrieve multiple keys in a
                  single request. Pass in an array of keys to this method and it will:
                  </p>
                  <ol>
                  <li>map the key to the appropriate memcached server
                  
                  </li>
                  <li>send a single request to each server that has one or more key values
                  
                  </li>
                  </ol>
                  <p>
                  Returns a hash of values.
                  </p>
                  <pre>cache[&quot;a&quot;] = 1&#x000A;cache[&quot;b&quot;] = 2&#x000A;cache.get_multi &quot;a&quot;, &quot;b&quot; # =&gt; { &quot;a&quot; =&gt; 1, &quot;b&quot; =&gt; 2 }</pre>
                  <p>
                  Note that <a href="MemCache.html#M000127">get_multi</a> assumes the values
                  are marshalled.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000127-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000127-source'>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/vendor/memcache-client-1.6.5/memcache.rb, line 223</span>&#x000A;223:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_multi</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">keys</span>)&#x000A;224:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-value str">'No active servers'</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">active?</span>&#x000A;225: &#x000A;226:     <span class="ruby-identifier">keys</span>.<span class="ruby-identifier">flatten!</span>&#x000A;227:     <span class="ruby-identifier">key_count</span> = <span class="ruby-identifier">keys</span>.<span class="ruby-identifier">length</span>&#x000A;228:     <span class="ruby-identifier">cache_keys</span> = {}&#x000A;229:     <span class="ruby-identifier">server_keys</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">h</span>,<span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">k</span>] = [] }&#x000A;230: &#x000A;231:     <span class="ruby-comment cmt"># map keys to servers</span>&#x000A;232:     <span class="ruby-identifier">keys</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span>&#x000A;233:       <span class="ruby-identifier">server</span>, <span class="ruby-identifier">cache_key</span> = <span class="ruby-identifier">request_setup</span> <span class="ruby-identifier">key</span>&#x000A;234:       <span class="ruby-identifier">cache_keys</span>[<span class="ruby-identifier">cache_key</span>] = <span class="ruby-identifier">key</span>&#x000A;235:       <span class="ruby-identifier">server_keys</span>[<span class="ruby-identifier">server</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">cache_key</span>&#x000A;236:     <span class="ruby-keyword kw">end</span>&#x000A;237: &#x000A;238:     <span class="ruby-identifier">results</span> = {}&#x000A;239: &#x000A;240:     <span class="ruby-identifier">server_keys</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">server</span>, <span class="ruby-identifier">keys_for_server</span><span class="ruby-operator">|</span>&#x000A;241:       <span class="ruby-identifier">keys_for_server_str</span> = <span class="ruby-identifier">keys_for_server</span>.<span class="ruby-identifier">join</span> <span class="ruby-value str">' '</span>&#x000A;242:       <span class="ruby-keyword kw">begin</span>&#x000A;243:         <span class="ruby-identifier">values</span> = <span class="ruby-identifier">cache_get_multi</span> <span class="ruby-identifier">server</span>, <span class="ruby-identifier">keys_for_server_str</span>&#x000A;244:         <span class="ruby-identifier">values</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>&#x000A;245:           <span class="ruby-identifier">results</span>[<span class="ruby-identifier">cache_keys</span>[<span class="ruby-identifier">key</span>]] = <span class="ruby-constant">Marshal</span>.<span class="ruby-identifier">load</span> <span class="ruby-identifier">value</span>&#x000A;246:         <span class="ruby-keyword kw">end</span>&#x000A;247:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">IndexError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>&#x000A;248:         <span class="ruby-comment cmt"># Ignore this server and try the others</span>&#x000A;249:         <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">warn</span> { <span class="ruby-node">&quot;Unable to retrieve #{keys_for_server.size} elements from #{server.inspect}: #{e.message}&quot;</span>} <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">logger</span>&#x000A;250:       <span class="ruby-keyword kw">end</span>&#x000A;251:     <span class="ruby-keyword kw">end</span>&#x000A;252: &#x000A;253:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">results</span>&#x000A;254:   <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">TypeError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">err</span>&#x000A;255:     <span class="ruby-identifier">handle_error</span> <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">err</span>&#x000A;256:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000128'>
                <a name='M000128'></a>
                <div class='synopsis'>
                  <span class='name'>incr</span>
                  <span class='arguments'>(key, amount = 1)</span>
                </div>
                <div class='description'>
                  <p>
                  Increments the value for <tt>key</tt> by <tt>amount</tt> and returns the
                  new value. <tt>key</tt> must already exist. If <tt>key</tt> is not an
                  integer, it is assumed to be 0.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000128-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000128-source'>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/vendor/memcache-client-1.6.5/memcache.rb, line 263</span>&#x000A;263:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">incr</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">amount</span> = <span class="ruby-value">1</span>)&#x000A;264:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-value str">&quot;Update of readonly cache&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@readonly</span>&#x000A;265:     <span class="ruby-identifier">with_server</span>(<span class="ruby-identifier">key</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">server</span>, <span class="ruby-identifier">cache_key</span><span class="ruby-operator">|</span>&#x000A;266:       <span class="ruby-identifier">cache_incr</span> <span class="ruby-identifier">server</span>, <span class="ruby-identifier">cache_key</span>, <span class="ruby-identifier">amount</span>&#x000A;267:     <span class="ruby-keyword kw">end</span>&#x000A;268:   <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">TypeError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">err</span>&#x000A;269:     <span class="ruby-identifier">handle_error</span> <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">err</span>&#x000A;270:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000121'>
                <a name='M000121'></a>
                <div class='synopsis'>
                  <span class='name'>inspect</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Returns a string representation of the cache object.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000121-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000121-source'>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/vendor/memcache-client-1.6.5/memcache.rb, line 129</span>&#x000A;129:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">inspect</span>&#x000A;130:     <span class="ruby-value str">&quot;&lt;MemCache: %d servers, ns: %p, ro: %p&gt;&quot;</span> <span class="ruby-operator">%</span>&#x000A;131:       [<span class="ruby-ivar">@servers</span>.<span class="ruby-identifier">length</span>, <span class="ruby-ivar">@namespace</span>, <span class="ruby-ivar">@readonly</span>]&#x000A;132:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000123'>
                <a name='M000123'></a>
                <div class='synopsis'>
                  <span class='name'>readonly?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Returns whether or not the cache object was created read only.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000123-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000123-source'>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/vendor/memcache-client-1.6.5/memcache.rb, line 144</span>&#x000A;144:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">readonly?</span>&#x000A;145:     <span class="ruby-ivar">@readonly</span>&#x000A;146:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000133'>
                <a name='M000133'></a>
                <div class='synopsis'>
                  <span class='name'>reset</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Reset the connection to all memcache servers. This should be called if
                  there is a problem with a cache lookup that might have left the connection
                  in a corrupted state.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000133-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000133-source'>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/vendor/memcache-client-1.6.5/memcache.rb, line 373</span>&#x000A;373:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reset</span>&#x000A;374:     <span class="ruby-ivar">@servers</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">server</span><span class="ruby-operator">|</span> <span class="ruby-identifier">server</span>.<span class="ruby-identifier">close</span> }&#x000A;375:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000124'>
                <a name='M000124'></a>
                <div class='synopsis'>
                  <span class='name'>servers=</span>
                  <span class='arguments'>(servers)</span>
                </div>
                <div class='description'>
                  <p>
                  Set the servers that the requests will be distributed between. Entries can
                  be either strings of the form &#8220;hostname:port&#8221; or
                  &#8220;hostname:port:weight&#8221; or <a
                  href="MemCache/Server.html">MemCache::Server</a> objects.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000124-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000124-source'>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/vendor/memcache-client-1.6.5/memcache.rb, line 153</span>&#x000A;153:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">servers=</span>(<span class="ruby-identifier">servers</span>)&#x000A;154:     <span class="ruby-comment cmt"># Create the server objects.</span>&#x000A;155:     <span class="ruby-ivar">@servers</span> = <span class="ruby-constant">Array</span>(<span class="ruby-identifier">servers</span>).<span class="ruby-identifier">collect</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">server</span><span class="ruby-operator">|</span>&#x000A;156:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">server</span>&#x000A;157:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">String</span>&#x000A;158:         <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>, <span class="ruby-identifier">weight</span> = <span class="ruby-identifier">server</span>.<span class="ruby-identifier">split</span> <span class="ruby-value str">':'</span>, <span class="ruby-value">3</span>&#x000A;159:         <span class="ruby-identifier">port</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">DEFAULT_PORT</span>&#x000A;160:         <span class="ruby-identifier">weight</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">DEFAULT_WEIGHT</span>&#x000A;161:         <span class="ruby-constant">Server</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>, <span class="ruby-identifier">weight</span>&#x000A;162:       <span class="ruby-keyword kw">else</span>&#x000A;163:         <span class="ruby-identifier">server</span>&#x000A;164:       <span class="ruby-keyword kw">end</span>&#x000A;165:     <span class="ruby-keyword kw">end</span>&#x000A;166: &#x000A;167:     <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> { <span class="ruby-node">&quot;Servers now: #{@servers.inspect}&quot;</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">logger</span>&#x000A;168: &#x000A;169:     <span class="ruby-comment cmt"># There's no point in doing this if there's only one server</span>&#x000A;170:     <span class="ruby-ivar">@continuum</span> = <span class="ruby-identifier">create_continuum_for</span>(<span class="ruby-ivar">@servers</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@servers</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>&#x000A;171: &#x000A;172:     <span class="ruby-ivar">@servers</span>&#x000A;173:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000129'>
                <a name='M000129'></a>
                <div class='synopsis'>
                  <span class='name'>set</span>
                  <span class='arguments'>(key, value, expiry = 0, raw = false)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000129-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000129-source'>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/vendor/memcache-client-1.6.5/memcache.rb, line 281</span>&#x000A;281:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span>, <span class="ruby-identifier">expiry</span> = <span class="ruby-value">0</span>, <span class="ruby-identifier">raw</span> = <span class="ruby-keyword kw">false</span>)&#x000A;282:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-value str">&quot;Update of readonly cache&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@readonly</span>&#x000A;283:     <span class="ruby-identifier">with_server</span>(<span class="ruby-identifier">key</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">server</span>, <span class="ruby-identifier">cache_key</span><span class="ruby-operator">|</span>&#x000A;284: &#x000A;285:       <span class="ruby-identifier">value</span> = <span class="ruby-constant">Marshal</span>.<span class="ruby-identifier">dump</span> <span class="ruby-identifier">value</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">raw</span>&#x000A;286:       <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> { <span class="ruby-node">&quot;SET #{key} to #{server.inspect}: #{value ? value.to_s.size : 'nil'}&quot;</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">logger</span>&#x000A;287: &#x000A;288:       <span class="ruby-identifier">data</span> = <span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_s</span>&#x000A;289:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-value str">&quot;Value too large, memcached can only store 1MB of data per key&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-constant">ONE_MB</span>&#x000A;290: &#x000A;291:       <span class="ruby-identifier">command</span> = <span class="ruby-node">&quot;set #{cache_key} 0 #{expiry} #{data.size}\r\n#{data}\r\n&quot;</span>&#x000A;292: &#x000A;293:       <span class="ruby-identifier">with_socket_management</span>(<span class="ruby-identifier">server</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">socket</span><span class="ruby-operator">|</span>&#x000A;294:         <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">command</span>&#x000A;295:         <span class="ruby-identifier">result</span> = <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">gets</span>&#x000A;296:         <span class="ruby-identifier">raise_on_error_response!</span> <span class="ruby-identifier">result</span>&#x000A;297: &#x000A;298:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">nil?</span>&#x000A;299:           <span class="ruby-identifier">server</span>.<span class="ruby-identifier">close</span>&#x000A;300:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-node">&quot;lost connection to #{server.host}:#{server.port}&quot;</span>&#x000A;301:         <span class="ruby-keyword kw">end</span>&#x000A;302: &#x000A;303:         <span class="ruby-identifier">result</span>&#x000A;304:       <span class="ruby-keyword kw">end</span>&#x000A;305:     <span class="ruby-keyword kw">end</span>&#x000A;306:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000134'>
                <a name='M000134'></a>
                <div class='synopsis'>
                  <span class='name'>stats</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Returns statistics for each memcached server. An explanation of the
                  statistics can be found in the memcached docs:
                  </p>
                  <p>
                  <a
                  href="http://code.sixapart.com/svn/memcached/trunk/server/doc/protocol.txt">code.sixapart.com/svn/memcached/trunk/server/doc/protocol.txt</a>
                  </p>
                  <p>
                  Example:
                  </p>
                  <pre>&gt;&gt; pp CACHE.stats&#x000A;{&quot;localhost:11211&quot;=&gt;&#x000A;  {&quot;bytes&quot;=&gt;4718,&#x000A;   &quot;pid&quot;=&gt;20188,&#x000A;   &quot;connection_structures&quot;=&gt;4,&#x000A;   &quot;time&quot;=&gt;1162278121,&#x000A;   &quot;pointer_size&quot;=&gt;32,&#x000A;   &quot;limit_maxbytes&quot;=&gt;67108864,&#x000A;   &quot;cmd_get&quot;=&gt;14532,&#x000A;   &quot;version&quot;=&gt;&quot;1.2.0&quot;,&#x000A;   &quot;bytes_written&quot;=&gt;432583,&#x000A;   &quot;cmd_set&quot;=&gt;32,&#x000A;   &quot;get_misses&quot;=&gt;0,&#x000A;   &quot;total_connections&quot;=&gt;19,&#x000A;   &quot;curr_connections&quot;=&gt;3,&#x000A;   &quot;curr_items&quot;=&gt;4,&#x000A;   &quot;uptime&quot;=&gt;1557,&#x000A;   &quot;get_hits&quot;=&gt;14532,&#x000A;   &quot;total_items&quot;=&gt;32,&#x000A;   &quot;rusage_system&quot;=&gt;0.313952,&#x000A;   &quot;rusage_user&quot;=&gt;0.119981,&#x000A;   &quot;bytes_read&quot;=&gt;190619}}&#x000A;=&gt; nil</pre>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000134-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000134-source'>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/vendor/memcache-client-1.6.5/memcache.rb, line 409</span>&#x000A;409:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">stats</span>&#x000A;410:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-value str">&quot;No active servers&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">active?</span>&#x000A;411:     <span class="ruby-identifier">server_stats</span> = {}&#x000A;412: &#x000A;413:     <span class="ruby-ivar">@servers</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">server</span><span class="ruby-operator">|</span>&#x000A;414:       <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">server</span>.<span class="ruby-identifier">alive?</span>&#x000A;415: &#x000A;416:       <span class="ruby-identifier">with_socket_management</span>(<span class="ruby-identifier">server</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">socket</span><span class="ruby-operator">|</span>&#x000A;417:         <span class="ruby-identifier">value</span> = <span class="ruby-keyword kw">nil</span>&#x000A;418:         <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">write</span> <span class="ruby-value str">&quot;stats\r\n&quot;</span>&#x000A;419:         <span class="ruby-identifier">stats</span> = {}&#x000A;420:         <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">line</span> = <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">gets</span> <span class="ruby-keyword kw">do</span>&#x000A;421:           <span class="ruby-identifier">raise_on_error_response!</span> <span class="ruby-identifier">line</span>&#x000A;422:           <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;END\r\n&quot;</span>&#x000A;423:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/\ASTAT ([\S]+) ([\w\.\:]+)/</span> <span class="ruby-keyword kw">then</span>&#x000A;424:             <span class="ruby-identifier">name</span>, <span class="ruby-identifier">value</span> = <span class="ruby-identifier">$1</span>, <span class="ruby-identifier">$2</span>&#x000A;425:             <span class="ruby-identifier">stats</span>[<span class="ruby-identifier">name</span>] = <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">name</span>&#x000A;426:                           <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'version'</span>&#x000A;427:                             <span class="ruby-identifier">value</span>&#x000A;428:                           <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'rusage_user'</span>, <span class="ruby-value str">'rusage_system'</span> <span class="ruby-keyword kw">then</span>&#x000A;429:                             <span class="ruby-identifier">seconds</span>, <span class="ruby-identifier">microseconds</span> = <span class="ruby-identifier">value</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/:/</span>, <span class="ruby-value">2</span>)&#x000A;430:                             <span class="ruby-identifier">microseconds</span> <span class="ruby-operator">||=</span> <span class="ruby-value">0</span>&#x000A;431:                             <span class="ruby-constant">Float</span>(<span class="ruby-identifier">seconds</span>) <span class="ruby-operator">+</span> (<span class="ruby-constant">Float</span>(<span class="ruby-identifier">microseconds</span>) <span class="ruby-operator">/</span> <span class="ruby-value">1_000_000</span>)&#x000A;432:                           <span class="ruby-keyword kw">else</span>&#x000A;433:                             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/\A\d+\Z/</span> <span class="ruby-keyword kw">then</span>&#x000A;434:                               <span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_i</span>&#x000A;435:                             <span class="ruby-keyword kw">else</span>&#x000A;436:                               <span class="ruby-identifier">value</span>&#x000A;437:                             <span class="ruby-keyword kw">end</span>&#x000A;438:                           <span class="ruby-keyword kw">end</span>&#x000A;439:           <span class="ruby-keyword kw">end</span>&#x000A;440:         <span class="ruby-keyword kw">end</span>&#x000A;441:         <span class="ruby-identifier">server_stats</span>[<span class="ruby-node">&quot;#{server.host}:#{server.port}&quot;</span>] = <span class="ruby-identifier">stats</span>&#x000A;442:       <span class="ruby-keyword kw">end</span>&#x000A;443:     <span class="ruby-keyword kw">end</span>&#x000A;444: &#x000A;445:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-value str">&quot;No active servers&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">server_stats</span>.<span class="ruby-identifier">empty?</span>&#x000A;446:     <span class="ruby-identifier">server_stats</span>&#x000A;447:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <h2>Protected instance methods</h2>
              <div class='method protected-instance' id='method-M000140'>
                <a name='M000140'></a>
                <div class='synopsis'>
                  <span class='name'>cache_decr</span>
                  <span class='arguments'>(server, cache_key, amount)</span>
                </div>
                <div class='description'>
                  <p>
                  Performs a raw decr for <tt>cache_key</tt> from <tt>server</tt>. Returns
                  nil if not found.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000140-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000140-source'>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/vendor/memcache-client-1.6.5/memcache.rb, line 511</span>&#x000A;511:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cache_decr</span>(<span class="ruby-identifier">server</span>, <span class="ruby-identifier">cache_key</span>, <span class="ruby-identifier">amount</span>)&#x000A;512:     <span class="ruby-identifier">with_socket_management</span>(<span class="ruby-identifier">server</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">socket</span><span class="ruby-operator">|</span>&#x000A;513:       <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">write</span> <span class="ruby-node">&quot;decr #{cache_key} #{amount}\r\n&quot;</span>&#x000A;514:       <span class="ruby-identifier">text</span> = <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">gets</span>&#x000A;515:       <span class="ruby-identifier">raise_on_error_response!</span> <span class="ruby-identifier">text</span>&#x000A;516:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">text</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;NOT_FOUND\r\n&quot;</span>&#x000A;517:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">text</span>.<span class="ruby-identifier">to_i</span>&#x000A;518:     <span class="ruby-keyword kw">end</span>&#x000A;519:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method protected-instance' id='method-M000141'>
                <a name='M000141'></a>
                <div class='synopsis'>
                  <span class='name'>cache_get</span>
                  <span class='arguments'>(server, cache_key)</span>
                </div>
                <div class='description'>
                  <p>
                  Fetches the raw data for <tt>cache_key</tt> from <tt>server</tt>. Returns
                  nil on cache miss.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000141-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000141-source'>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/vendor/memcache-client-1.6.5/memcache.rb, line 525</span>&#x000A;525:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cache_get</span>(<span class="ruby-identifier">server</span>, <span class="ruby-identifier">cache_key</span>)&#x000A;526:     <span class="ruby-identifier">with_socket_management</span>(<span class="ruby-identifier">server</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">socket</span><span class="ruby-operator">|</span>&#x000A;527:       <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">write</span> <span class="ruby-node">&quot;get #{cache_key}\r\n&quot;</span>&#x000A;528:       <span class="ruby-identifier">keyline</span> = <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">gets</span> <span class="ruby-comment cmt"># &quot;VALUE &lt;key&gt; &lt;flags&gt; &lt;bytes&gt;\r\n&quot;</span>&#x000A;529: &#x000A;530:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">keyline</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">then</span>&#x000A;531:         <span class="ruby-identifier">server</span>.<span class="ruby-identifier">close</span>&#x000A;532:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-node">&quot;lost connection to #{server.host}:#{server.port}&quot;</span>&#x000A;533:       <span class="ruby-keyword kw">end</span>&#x000A;534: &#x000A;535:       <span class="ruby-identifier">raise_on_error_response!</span> <span class="ruby-identifier">keyline</span>&#x000A;536:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">keyline</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;END\r\n&quot;</span>&#x000A;537: &#x000A;538:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">keyline</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/(\d+)\r/</span> <span class="ruby-keyword kw">then</span>&#x000A;539:         <span class="ruby-identifier">server</span>.<span class="ruby-identifier">close</span>&#x000A;540:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-node">&quot;unexpected response #{keyline.inspect}&quot;</span>&#x000A;541:       <span class="ruby-keyword kw">end</span>&#x000A;542:       <span class="ruby-identifier">value</span> = <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">read</span> <span class="ruby-identifier">$1</span>.<span class="ruby-identifier">to_i</span>&#x000A;543:       <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">read</span> <span class="ruby-value">2</span> <span class="ruby-comment cmt"># &quot;\r\n&quot;</span>&#x000A;544:       <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">gets</span>   <span class="ruby-comment cmt"># &quot;END\r\n&quot;</span>&#x000A;545:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">value</span>&#x000A;546:     <span class="ruby-keyword kw">end</span>&#x000A;547:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method protected-instance' id='method-M000142'>
                <a name='M000142'></a>
                <div class='synopsis'>
                  <span class='name'>cache_get_multi</span>
                  <span class='arguments'>(server, cache_keys)</span>
                </div>
                <div class='description'>
                  <p>
                  Fetches <tt>cache_keys</tt> from <tt>server</tt> using a multi-get.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000142-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000142-source'>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/vendor/memcache-client-1.6.5/memcache.rb, line 552</span>&#x000A;552:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cache_get_multi</span>(<span class="ruby-identifier">server</span>, <span class="ruby-identifier">cache_keys</span>)&#x000A;553:     <span class="ruby-identifier">with_socket_management</span>(<span class="ruby-identifier">server</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">socket</span><span class="ruby-operator">|</span>&#x000A;554:       <span class="ruby-identifier">values</span> = {}&#x000A;555:       <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">write</span> <span class="ruby-node">&quot;get #{cache_keys}\r\n&quot;</span>&#x000A;556: &#x000A;557:       <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">keyline</span> = <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">gets</span> <span class="ruby-keyword kw">do</span>&#x000A;558:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">values</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">keyline</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;END\r\n&quot;</span>&#x000A;559:         <span class="ruby-identifier">raise_on_error_response!</span> <span class="ruby-identifier">keyline</span>&#x000A;560: &#x000A;561:         <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">keyline</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/\AVALUE (.+) (.+) (.+)/</span> <span class="ruby-keyword kw">then</span>&#x000A;562:           <span class="ruby-identifier">server</span>.<span class="ruby-identifier">close</span>&#x000A;563:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-node">&quot;unexpected response #{keyline.inspect}&quot;</span>&#x000A;564:         <span class="ruby-keyword kw">end</span>&#x000A;565: &#x000A;566:         <span class="ruby-identifier">key</span>, <span class="ruby-identifier">data_length</span> = <span class="ruby-identifier">$1</span>, <span class="ruby-identifier">$3</span>&#x000A;567:         <span class="ruby-identifier">values</span>[<span class="ruby-identifier">$1</span>] = <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">read</span> <span class="ruby-identifier">data_length</span>.<span class="ruby-identifier">to_i</span>&#x000A;568:         <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">read</span>(<span class="ruby-value">2</span>) <span class="ruby-comment cmt"># &quot;\r\n&quot;</span>&#x000A;569:       <span class="ruby-keyword kw">end</span>&#x000A;570: &#x000A;571:       <span class="ruby-identifier">server</span>.<span class="ruby-identifier">close</span>&#x000A;572:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-node">&quot;lost connection to #{server.host}:#{server.port}&quot;</span> <span class="ruby-comment cmt"># TODO: retry here too</span>&#x000A;573:     <span class="ruby-keyword kw">end</span>&#x000A;574:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method protected-instance' id='method-M000143'>
                <a name='M000143'></a>
                <div class='synopsis'>
                  <span class='name'>cache_incr</span>
                  <span class='arguments'>(server, cache_key, amount)</span>
                </div>
                <div class='description'>
                  <p>
                  Performs a raw incr for <tt>cache_key</tt> from <tt>server</tt>. Returns
                  nil if not found.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000143-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000143-source'>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/vendor/memcache-client-1.6.5/memcache.rb, line 580</span>&#x000A;580:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cache_incr</span>(<span class="ruby-identifier">server</span>, <span class="ruby-identifier">cache_key</span>, <span class="ruby-identifier">amount</span>)&#x000A;581:     <span class="ruby-identifier">with_socket_management</span>(<span class="ruby-identifier">server</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">socket</span><span class="ruby-operator">|</span>&#x000A;582:       <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">write</span> <span class="ruby-node">&quot;incr #{cache_key} #{amount}\r\n&quot;</span>&#x000A;583:       <span class="ruby-identifier">text</span> = <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">gets</span>&#x000A;584:       <span class="ruby-identifier">raise_on_error_response!</span> <span class="ruby-identifier">text</span>&#x000A;585:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">text</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;NOT_FOUND\r\n&quot;</span>&#x000A;586:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">text</span>.<span class="ruby-identifier">to_i</span>&#x000A;587:     <span class="ruby-keyword kw">end</span>&#x000A;588:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method protected-instance' id='method-M000151'>
                <a name='M000151'></a>
                <div class='synopsis'>
                  <span class='name'>check_multithread_status!</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000151-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000151-source'>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/vendor/memcache-client-1.6.5/memcache.rb, line 698</span>&#x000A;698:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">check_multithread_status!</span>&#x000A;699:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@multithread</span>&#x000A;700: &#x000A;701:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>[<span class="ruby-identifier">:memcache_client</span>] <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">object_id</span>&#x000A;702:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-value str">&quot;You are accessing this memcache-client instance from multiple threads but have not enabled multithread support.\nNormally:  MemCache.new(['localhost:11211'], :multithread =&gt; true)\nIn Rails:  config.cache_store = [:mem_cache_store, 'localhost:11211', { :multithread =&gt; true }]\n&quot;</span>&#x000A;703:     <span class="ruby-keyword kw">end</span>&#x000A;704:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method protected-instance' id='method-M000149'>
                <a name='M000149'></a>
                <div class='synopsis'>
                  <span class='name'>create_continuum_for</span>
                  <span class='arguments'>(servers)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000149-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000149-source'>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/vendor/memcache-client-1.6.5/memcache.rb, line 679</span>&#x000A;679:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_continuum_for</span>(<span class="ruby-identifier">servers</span>)&#x000A;680:     <span class="ruby-identifier">total_weight</span> = <span class="ruby-identifier">servers</span>.<span class="ruby-identifier">inject</span>(<span class="ruby-value">0</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">memo</span>, <span class="ruby-identifier">srv</span><span class="ruby-operator">|</span> <span class="ruby-identifier">memo</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">srv</span>.<span class="ruby-identifier">weight</span> }&#x000A;681:     <span class="ruby-identifier">continuum</span> = []&#x000A;682: &#x000A;683:     <span class="ruby-identifier">servers</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">server</span><span class="ruby-operator">|</span>&#x000A;684:       <span class="ruby-identifier">entry_count_for</span>(<span class="ruby-identifier">server</span>, <span class="ruby-identifier">servers</span>.<span class="ruby-identifier">size</span>, <span class="ruby-identifier">total_weight</span>).<span class="ruby-identifier">times</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">idx</span><span class="ruby-operator">|</span>&#x000A;685:         <span class="ruby-identifier">hash</span> = <span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">SHA1</span>.<span class="ruby-identifier">hexdigest</span>(<span class="ruby-node">&quot;#{server.host}:#{server.port}:#{idx}&quot;</span>)&#x000A;686:         <span class="ruby-identifier">value</span> = <span class="ruby-constant">Integer</span>(<span class="ruby-node">&quot;0x#{hash[0..7]}&quot;</span>)&#x000A;687:         <span class="ruby-identifier">continuum</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Continuum</span><span class="ruby-operator">::</span><span class="ruby-constant">Entry</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">value</span>, <span class="ruby-identifier">server</span>)&#x000A;688:       <span class="ruby-keyword kw">end</span>&#x000A;689:     <span class="ruby-keyword kw">end</span>&#x000A;690: &#x000A;691:     <span class="ruby-identifier">continuum</span>.<span class="ruby-identifier">sort</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">a</span>, <span class="ruby-identifier">b</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">value</span> <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">value</span> }&#x000A;692:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method protected-instance' id='method-M000150'>
                <a name='M000150'></a>
                <div class='synopsis'>
                  <span class='name'>entry_count_for</span>
                  <span class='arguments'>(server, total_servers, total_weight)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000150-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000150-source'>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/vendor/memcache-client-1.6.5/memcache.rb, line 694</span>&#x000A;694:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">entry_count_for</span>(<span class="ruby-identifier">server</span>, <span class="ruby-identifier">total_servers</span>, <span class="ruby-identifier">total_weight</span>)&#x000A;695:     ((<span class="ruby-identifier">total_servers</span> <span class="ruby-operator">*</span> <span class="ruby-constant">Continuum</span><span class="ruby-operator">::</span><span class="ruby-constant">POINTS_PER_SERVER</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">server</span>.<span class="ruby-identifier">weight</span>) <span class="ruby-operator">/</span> <span class="ruby-constant">Float</span>(<span class="ruby-identifier">total_weight</span>)).<span class="ruby-identifier">floor</span>&#x000A;696:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method protected-instance' id='method-M000139'>
                <a name='M000139'></a>
                <div class='synopsis'>
                  <span class='name'>get_server_for_key</span>
                  <span class='arguments'>(key, options = {})</span>
                </div>
                <div class='description'>
                  <p>
                  Pick a server to handle the request based on a hash of the key.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000139-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000139-source'>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/vendor/memcache-client-1.6.5/memcache.rb, line 487</span>&#x000A;487:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_server_for_key</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">options</span> = {})&#x000A;488:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;illegal character in key #{key.inspect}&quot;</span> <span class="ruby-keyword kw">if</span>&#x000A;489:       <span class="ruby-identifier">key</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/\s/</span>&#x000A;490:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;key too long #{key.inspect}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">250</span>&#x000A;491:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-value str">&quot;No servers available&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@servers</span>.<span class="ruby-identifier">empty?</span>&#x000A;492:     <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@servers</span>.<span class="ruby-identifier">first</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@servers</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>&#x000A;493: &#x000A;494:     <span class="ruby-identifier">hkey</span> = <span class="ruby-identifier">hash_for</span>(<span class="ruby-identifier">key</span>)&#x000A;495: &#x000A;496:     <span class="ruby-value">20</span>.<span class="ruby-identifier">times</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">try</span><span class="ruby-operator">|</span>&#x000A;497:       <span class="ruby-identifier">entryidx</span> = <span class="ruby-constant">Continuum</span>.<span class="ruby-identifier">binary_search</span>(<span class="ruby-ivar">@continuum</span>, <span class="ruby-identifier">hkey</span>)&#x000A;498:       <span class="ruby-identifier">server</span> = <span class="ruby-ivar">@continuum</span>[<span class="ruby-identifier">entryidx</span>].<span class="ruby-identifier">server</span>&#x000A;499:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">server</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">server</span>.<span class="ruby-identifier">alive?</span>&#x000A;500:       <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">failover</span>&#x000A;501:       <span class="ruby-identifier">hkey</span> = <span class="ruby-identifier">hash_for</span> <span class="ruby-node">&quot;#{try}#{key}&quot;</span>&#x000A;502:     <span class="ruby-keyword kw">end</span>&#x000A;503: &#x000A;504:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-value str">&quot;No servers available&quot;</span>&#x000A;505:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method protected-instance' id='method-M000146'>
                <a name='M000146'></a>
                <div class='synopsis'>
                  <span class='name'>handle_error</span>
                  <span class='arguments'>(server, error)</span>
                </div>
                <div class='description'>
                  <p>
                  Handles <tt>error</tt> from <tt>server</tt>.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000146-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000146-source'>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/vendor/memcache-client-1.6.5/memcache.rb, line 654</span>&#x000A;654:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">handle_error</span>(<span class="ruby-identifier">server</span>, <span class="ruby-identifier">error</span>)&#x000A;655:     <span class="ruby-identifier">raise</span> <span class="ruby-identifier">error</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">error</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">MemCacheError</span>)&#x000A;656:     <span class="ruby-identifier">server</span>.<span class="ruby-identifier">close</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">server</span>&#x000A;657:     <span class="ruby-identifier">new_error</span> = <span class="ruby-constant">MemCacheError</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">error</span>.<span class="ruby-identifier">message</span>&#x000A;658:     <span class="ruby-identifier">new_error</span>.<span class="ruby-identifier">set_backtrace</span> <span class="ruby-identifier">error</span>.<span class="ruby-identifier">backtrace</span>&#x000A;659:     <span class="ruby-identifier">raise</span> <span class="ruby-identifier">new_error</span>&#x000A;660:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method protected-instance' id='method-M000138'>
                <a name='M000138'></a>
                <div class='synopsis'>
                  <span class='name'>hash_for</span>
                  <span class='arguments'>(key)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns an interoperable hash value for <tt>key</tt>. (I think, docs are
                  sketchy for down servers).
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000138-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000138-source'>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/vendor/memcache-client-1.6.5/memcache.rb, line 480</span>&#x000A;480:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">hash_for</span>(<span class="ruby-identifier">key</span>)&#x000A;481:     <span class="ruby-constant">Zlib</span>.<span class="ruby-identifier">crc32</span>(<span class="ruby-identifier">key</span>)&#x000A;482:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method protected-instance' id='method-M000137'>
                <a name='M000137'></a>
                <div class='synopsis'>
                  <span class='name'>make_cache_key</span>
                  <span class='arguments'>(key)</span>
                </div>
                <div class='description'>
                  <p>
                  Create a key for the cache, incorporating the namespace qualifier if
                  requested.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000137-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000137-source'>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/vendor/memcache-client-1.6.5/memcache.rb, line 468</span>&#x000A;468:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">make_cache_key</span>(<span class="ruby-identifier">key</span>)&#x000A;469:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">namespace</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">then</span>&#x000A;470:       <span class="ruby-identifier">key</span>&#x000A;471:     <span class="ruby-keyword kw">else</span>&#x000A;472:       <span class="ruby-node">&quot;#{@namespace}:#{key}&quot;</span>&#x000A;473:     <span class="ruby-keyword kw">end</span>&#x000A;474:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method protected-instance' id='method-M000148'>
                <a name='M000148'></a>
                <div class='synopsis'>
                  <span class='name'>raise_on_error_response!</span>
                  <span class='arguments'>(response)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000148-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000148-source'>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/vendor/memcache-client-1.6.5/memcache.rb, line 673</span>&#x000A;673:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">raise_on_error_response!</span>(<span class="ruby-identifier">response</span>)&#x000A;674:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">response</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/\A(?:CLIENT_|SERVER_)?ERROR(.*)/</span>&#x000A;675:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-identifier">$1</span>.<span class="ruby-identifier">strip</span>&#x000A;676:     <span class="ruby-keyword kw">end</span>&#x000A;677:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method protected-instance' id='method-M000147'>
                <a name='M000147'></a>
                <div class='synopsis'>
                  <span class='name'>request_setup</span>
                  <span class='arguments'>(key)</span>
                </div>
                <div class='description'>
                  <p>
                  Performs setup for making a request with <tt>key</tt> from memcached.
                  Returns the server to fetch the key from and the complete key to use.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000147-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000147-source'>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/vendor/memcache-client-1.6.5/memcache.rb, line 666</span>&#x000A;666:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">request_setup</span>(<span class="ruby-identifier">key</span>)&#x000A;667:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-value str">'No active servers'</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">active?</span>&#x000A;668:     <span class="ruby-identifier">cache_key</span> = <span class="ruby-identifier">make_cache_key</span> <span class="ruby-identifier">key</span>&#x000A;669:     <span class="ruby-identifier">server</span> = <span class="ruby-identifier">get_server_for_key</span> <span class="ruby-identifier">cache_key</span>&#x000A;670:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">server</span>, <span class="ruby-identifier">cache_key</span>&#x000A;671:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method protected-instance' id='method-M000145'>
                <a name='M000145'></a>
                <div class='synopsis'>
                  <span class='name'>with_server</span>
                  <span class='arguments'>(key) {|server, cache_key| ...}</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000145-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000145-source'>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/vendor/memcache-client-1.6.5/memcache.rb, line 635</span>&#x000A;635:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">with_server</span>(<span class="ruby-identifier">key</span>)&#x000A;636:     <span class="ruby-identifier">retried</span> = <span class="ruby-keyword kw">false</span>&#x000A;637:     <span class="ruby-keyword kw">begin</span>&#x000A;638:       <span class="ruby-identifier">server</span>, <span class="ruby-identifier">cache_key</span> = <span class="ruby-identifier">request_setup</span>(<span class="ruby-identifier">key</span>)&#x000A;639:       <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">server</span>, <span class="ruby-identifier">cache_key</span>&#x000A;640:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">IndexError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>&#x000A;641:       <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">warn</span> { <span class="ruby-node">&quot;Server failed: #{e.class.name}: #{e.message}&quot;</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">logger</span>&#x000A;642:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">retried</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@servers</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>&#x000A;643:         <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> { <span class="ruby-node">&quot;Connection to server #{server.inspect} DIED! Retrying operation...&quot;</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">logger</span>&#x000A;644:         <span class="ruby-identifier">retried</span> = <span class="ruby-keyword kw">true</span>&#x000A;645:         <span class="ruby-keyword kw">retry</span>&#x000A;646:       <span class="ruby-keyword kw">end</span>&#x000A;647:       <span class="ruby-identifier">handle_error</span>(<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">e</span>)&#x000A;648:     <span class="ruby-keyword kw">end</span>&#x000A;649:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method protected-instance' id='method-M000144'>
                <a name='M000144'></a>
                <div class='synopsis'>
                  <span class='name'>with_socket_management</span>
                  <span class='arguments'>(server, &amp;block)</span>
                </div>
                <div class='description'>
                  <p>
                  Gets or creates a socket connected to the given server, and yields it to
                  the block, wrapped in a mutex synchronization if @multithread is true.
                  </p>
                  <p>
                  If a socket error (SocketError, SystemCallError, IOError) or protocol error
                  (<a href="MemCache/MemCacheError.html">MemCacheError</a>) is raised by the
                  block, closes the socket, attempts to connect again, and retries the block
                  (once). If an error is again raised, reraises it as <a
                  href="MemCache/MemCacheError.html">MemCacheError</a>.
                  </p>
                  <p>
                  If unable to connect to the server (or if in the reconnect wait period),
                  raises <a href="MemCache/MemCacheError.html">MemCacheError</a>. Note that
                  the socket connect code marks a server dead for a timeout period, so
                  retrying does not apply to connection attempt failures (but does still
                  apply to unexpectedly lost connections etc.).
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000144-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000144-source'>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/vendor/memcache-client-1.6.5/memcache.rb, line 604</span>&#x000A;604:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">with_socket_management</span>(<span class="ruby-identifier">server</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)&#x000A;605:     <span class="ruby-identifier">check_multithread_status!</span>&#x000A;606: &#x000A;607:     <span class="ruby-ivar">@mutex</span>.<span class="ruby-identifier">lock</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@multithread</span>&#x000A;608:     <span class="ruby-identifier">retried</span> = <span class="ruby-keyword kw">false</span>&#x000A;609: &#x000A;610:     <span class="ruby-keyword kw">begin</span>&#x000A;611:       <span class="ruby-identifier">socket</span> = <span class="ruby-identifier">server</span>.<span class="ruby-identifier">socket</span>&#x000A;612: &#x000A;613:       <span class="ruby-comment cmt"># Raise an IndexError to show this server is out of whack. If were inside</span>&#x000A;614:       <span class="ruby-comment cmt"># a with_server block, we'll catch it and attempt to restart the operation.</span>&#x000A;615: &#x000A;616:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">IndexError</span>, <span class="ruby-node">&quot;No connection to server (#{server.status})&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">nil?</span>&#x000A;617: &#x000A;618:       <span class="ruby-identifier">block</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">socket</span>)&#x000A;619: &#x000A;620:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">SocketError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">err</span>&#x000A;621:       <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">warn</span> { <span class="ruby-node">&quot;Socket failure: #{err.message}&quot;</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">logger</span>&#x000A;622:       <span class="ruby-identifier">server</span>.<span class="ruby-identifier">mark_dead</span>(<span class="ruby-identifier">err</span>)&#x000A;623:       <span class="ruby-identifier">handle_error</span>(<span class="ruby-identifier">server</span>, <span class="ruby-identifier">err</span>)&#x000A;624: &#x000A;625:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">MemCacheError</span>, <span class="ruby-constant">SystemCallError</span>, <span class="ruby-constant">IOError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">err</span>&#x000A;626:       <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">warn</span> { <span class="ruby-node">&quot;Generic failure: #{err.class.name}: #{err.message}&quot;</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">logger</span>&#x000A;627:       <span class="ruby-identifier">handle_error</span>(<span class="ruby-identifier">server</span>, <span class="ruby-identifier">err</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">retried</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">nil?</span>&#x000A;628:       <span class="ruby-identifier">retried</span> = <span class="ruby-keyword kw">true</span>&#x000A;629:       <span class="ruby-keyword kw">retry</span>&#x000A;630:     <span class="ruby-keyword kw">end</span>&#x000A;631:   <span class="ruby-keyword kw">ensure</span>&#x000A;632:     <span class="ruby-ivar">@mutex</span>.<span class="ruby-identifier">unlock</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@multithread</span>&#x000A;633:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
