<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>: Fixtures [Rails Framework Documentation]</title>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
    <link href='../rdoc-style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='class' id='wrapper'>
      <div class='header'>
        <div class='name'>
          <span class='type'>Class</span>
          Fixtures
        </div>
        <ol class='paths'>
          <li>
            <a href="../files/vendor/rails/activerecord/lib/active_record/fixtures_rb.html">vendor/rails/activerecord/lib/active_record/fixtures.rb</a>
          </li>
        </ol>
        <div class='parent'>
          Parent:
          <strong>(RUBY_VERSION &lt; '1.9' ? YAML::Omap : Hash)</strong>
        </div>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='description'>
            <p>
            <a href="Fixtures.html">Fixtures</a> are a way of organizing data that you
            want to test against; in short, sample data.
            </p>
            <h1>Fixture formats</h1>
            <p>
            <a href="Fixtures.html">Fixtures</a> come in 3 flavors:
            </p>
            <pre>1.  YAML fixtures&#x000A;2.  CSV fixtures&#x000A;3.  Single-file fixtures</pre>
            <h2>YAML fixtures</h2>
            <p>
            This type of fixture is in YAML format and the preferred default. YAML is a
            file format which describes data structures in a non-verbose,
            human-readable format. It ships with Ruby 1.8.1+.
            </p>
            <p>
            Unlike single-file fixtures, YAML fixtures are stored in a single file per
            model, which are placed in the directory appointed by
            <tt>ActiveSupport::TestCase.fixture_path=(path)</tt> (this is automatically
            configured for <a href="Rails.html">Rails</a>, so you can just put your
            files in <tt>&lt;your-rails-app&gt;/test/fixtures/</tt>). The fixture file
            ends with the <tt>.yml</tt> file extension (<a href="Rails.html">Rails</a>
            example: <tt>&lt;your-rails-app&gt;/test/fixtures/web_sites.yml</tt>). The
            format of a YAML fixture file looks like this:
            </p>
            <pre>rubyonrails:&#x000A;  id: 1&#x000A;  name: Ruby on Rails&#x000A;  url: http://www.rubyonrails.org&#x000A;&#x000A;google:&#x000A;  id: 2&#x000A;  name: Google&#x000A;  url: http://www.google.com</pre>
            <p>
            This YAML fixture file includes two fixtures. Each YAML fixture (ie.
            record) is given a name and is followed by an indented list of key/value
            pairs in the &#8220;key: value&#8221; format. Records are separated by a
            blank line for your viewing pleasure.
            </p>
            <p>
            Note that YAML fixtures are unordered. If you want ordered fixtures, use
            the omap YAML type. See <a
            href="http://yaml.org/type/omap.html">yaml.org/type/omap.html</a> for the
            specification. You will need ordered fixtures when you have foreign key
            constraints on keys in the same table. This is commonly needed for tree
            structures. Example:
            </p>
            <pre>--- !omap&#x000A;- parent:&#x000A;    id:         1&#x000A;    parent_id:  NULL&#x000A;    title:      Parent&#x000A;- child:&#x000A;    id:         2&#x000A;    parent_id:  1&#x000A;    title:      Child</pre>
            <h2>CSV fixtures</h2>
            <p>
            <a href="Fixtures.html">Fixtures</a> can also be kept in the Comma
            Separated Value (CSV) format. Akin to YAML fixtures, CSV fixtures are
            stored in a single file, but instead end with the <tt>.csv</tt> file
            extension (<a href="Rails.html">Rails</a> example:
            <tt>&lt;your-rails-app&gt;/test/fixtures/web_sites.csv</tt>).
            </p>
            <p>
            The format of this type of fixture file is much more compact than the
            others, but also a little harder to read by us humans. The first line of
            the CSV file is a comma-separated list of field names. The rest of the file
            is then comprised of the actual data (1 per line). Here&#8217;s an example:
            </p>
            <pre>id, name, url&#x000A;1, Ruby On Rails, http://www.rubyonrails.org&#x000A;2, Google, http://www.google.com</pre>
            <p>
            Should you have a piece of data with a comma character in it, you can place
            double quotes around that value. If you need to use a double quote
            character, you must escape it with another double quote.
            </p>
            <p>
            Another unique attribute of the CSV fixture is that it has <b>no</b>
            fixture name like the other two formats. Instead, the fixture names are
            automatically generated by deriving the class name of the fixture file and
            adding an incrementing number to the end. In our example, the 1st fixture
            would be called &#8220;web_site_1&#8220; and the 2nd one would be called
            &#8220;web_site_2&#8220;.
            </p>
            <p>
            Most databases and spreadsheets support exporting to CSV format, so this is
            a great format for you to choose if you have existing data somewhere
            already.
            </p>
            <h2>Single-file fixtures</h2>
            <p>
            This type of fixture was the original format for Active Record that has
            since been deprecated in favor of the YAML and CSV formats. <a
            href="Fixtures.html">Fixtures</a> for this format are created by placing
            text files in a sub-directory (with the name of the model) to the directory
            appointed by <tt>ActiveSupport::TestCase.fixture_path=(path)</tt> (this is
            automatically configured for <a href="Rails.html">Rails</a>, so you can
            just put your files in
            <tt>&lt;your-rails-app&gt;/test/fixtures/&lt;your-model-name&gt;/</tt>
            &#8212; like <tt>&lt;your-rails-app&gt;/test/fixtures/web_sites/</tt> for
            the WebSite model).
            </p>
            <p>
            Each text file placed in this directory represents a &#8220;record&#8221;.
            Usually these types of fixtures are named without extensions, but if you
            are on a Windows machine, you might consider adding <tt>.txt</tt> as the
            extension. Here&#8217;s what the above example might look like:
            </p>
            <pre>web_sites/google&#x000A;web_sites/yahoo.txt&#x000A;web_sites/ruby-on-rails</pre>
            <p>
            The file format of a standard fixture is simple. Each line is a property
            (or column in db speak) and has the syntax of &#8220;name => value&#8221;.
            Here&#8217;s an example of the ruby-on-rails fixture above:
            </p>
            <pre>id =&gt; 1&#x000A;name =&gt; Ruby on Rails&#x000A;url =&gt; http://www.rubyonrails.org</pre>
            <h1>Using fixtures in testcases</h1>
            <p>
            Since fixtures are a testing construct, we use them in our unit and
            functional tests. There are two ways to use the fixtures, but first
            let&#8217;s take a look at a sample unit test:
            </p>
            <pre>require 'test_helper'&#x000A;&#x000A;class WebSiteTest &lt; ActiveSupport::TestCase&#x000A;  test &quot;web_site_count&quot; do&#x000A;    assert_equal 2, WebSite.count&#x000A;  end&#x000A;end</pre>
            <p>
            By default, the <tt>test_helper module</tt> will load all of your fixtures
            into your test database, so this test will succeed. The testing environment
            will automatically load the all fixtures into the database before each
            test. To ensure consistent data, the environment deletes the fixtures
            before running the load.
            </p>
            <p>
            In addition to being available in the database, the fixture&#8217;s data
            may also be accessed by using a special dynamic method, which has the same
            name as the model, and accepts the name of the fixture to instantiate:
            </p>
            <pre>test &quot;find&quot; do&#x000A;  assert_equal &quot;Ruby on Rails&quot;, web_sites(:rubyonrails).name&#x000A;end</pre>
            <p>
            Alternatively, you may enable auto-instantiation of the fixture data. For
            instance, take the following tests:
            </p>
            <pre>test &quot;find_alt_method_1&quot; do&#x000A;  assert_equal &quot;Ruby on Rails&quot;, @web_sites['rubyonrails']['name']&#x000A;end&#x000A;&#x000A;test &quot;find_alt_method_2&quot; do&#x000A;  assert_equal &quot;Ruby on Rails&quot;, @rubyonrails.news&#x000A;end</pre>
            <p>
            In order to use these methods to access fixtured data within your
            testcases, you must specify one of the following in your
            <tt>ActiveSupport::TestCase</tt>-derived class:
            </p>
            <ul>
            <li>to fully enable instantiated fixtures (enable alternate methods 1 and 2
            above)
            
            <pre>self.use_instantiated_fixtures = true</pre>
            </li>
            <li>create only the hash for the fixtures, do not &#8216;find&#8217; each
            instance (enable alternate method 1 only)
            
            <pre>self.use_instantiated_fixtures = :no_instances</pre>
            </li>
            </ul>
            <p>
            Using either of these alternate methods incurs a performance hit, as the
            fixtured data must be fully traversed in the database to create the fixture
            hash and/or instance variables. This is expensive for large sets of
            fixtured data.
            </p>
            <h1>Dynamic fixtures with ERb</h1>
            <p>
            Some times you don&#8217;t care about the content of the fixtures as much
            as you care about the volume. In these cases, you can mix ERb in with your
            YAML or CSV fixtures to create a bunch of fixtures for load testing, like:
            </p>
            <pre>&lt;% for i in 1..1000 %&gt;&#x000A;fix_&lt;%= i %&gt;:&#x000A;  id: &lt;%= i %&gt;&#x000A;  name: guy_&lt;%= 1 %&gt;&#x000A;&lt;% end %&gt;</pre>
            <p>
            This will create 1000 very simple YAML fixtures.
            </p>
            <p>
            Using ERb, you can also inject dynamic values into your fixtures with
            inserts like <tt>&lt;%= Date.today.strftime(&quot;%Y-%m-%d&quot;)
            %&gt;</tt>. This is however a feature to be used with some caution. The
            point of fixtures are that they&#8217;re stable units of predictable sample
            data. If you feel that you need to inject dynamic values, then perhaps you
            should reexamine whether your application is properly testable. Hence,
            dynamic values in fixtures are to be considered a code smell.
            </p>
            <h1>Transactional fixtures</h1>
            <p>
            TestCases can use begin+rollback to isolate their changes to the database
            instead of having to delete+insert for every test case.
            </p>
            <pre>class FooTest &lt; ActiveSupport::TestCase&#x000A;  self.use_transactional_fixtures = true&#x000A;&#x000A;  test &quot;godzilla&quot; do&#x000A;    assert !Foo.find(:all).empty?&#x000A;    Foo.destroy_all&#x000A;    assert Foo.find(:all).empty?&#x000A;  end&#x000A;&#x000A;  test &quot;godzilla aftermath&quot; do&#x000A;    assert !Foo.find(:all).empty?&#x000A;  end&#x000A;end</pre>
            <p>
            If you preload your test database with all fixture data (probably in the
            Rakefile task) and use transactional fixtures, then you may omit all
            fixtures declarations in your test cases since all the data&#8217;s already
            there and every case rolls back its changes.
            </p>
            <p>
            In order to use instantiated fixtures with preloaded data, set
            <tt>self.pre_loaded_fixtures</tt> to true. This will provide access to
            fixture data for every table that has been loaded through fixtures
            (depending on the value of <tt>use_instantiated_fixtures</tt>)
            </p>
            <p>
            When <b>not</b> to use transactional fixtures:
            </p>
            <ol>
            <li>You&#8217;re testing whether a transaction works correctly. Nested
            transactions don&#8217;t commit until all parent transactions commit,
            particularly, the fixtures transaction which is begun in setup and rolled
            back in teardown. Thus, you won&#8217;t be able to verify the results of
            your transaction until Active Record supports nested transactions or
            savepoints (in progress).
            
            </li>
            <li>Your database does not support transactions. Every Active Record database
            supports transactions except MySQL MyISAM. Use InnoDB, MaxDB, or NDB
            instead.
            
            </li>
            </ol>
            <h1>Advanced YAML <a href="Fixtures.html">Fixtures</a></h1>
            <p>
            YAML fixtures that don&#8217;t specify an ID get some extra features:
            </p>
            <ul>
            <li>Stable, autogenerated IDs
            
            </li>
            <li>Label references for associations (belongs_to, has_one, has_many)
            
            </li>
            <li>HABTM associations as inline lists
            
            </li>
            <li>Autofilled timestamp columns
            
            </li>
            <li>Fixture label interpolation
            
            </li>
            <li>Support for YAML defaults
            
            </li>
            </ul>
            <h2>Stable, autogenerated IDs</h2>
            <p>
            Here, have a monkey fixture:
            </p>
            <pre>george:&#x000A;  id: 1&#x000A;  name: George the Monkey&#x000A;&#x000A;reginald:&#x000A;  id: 2&#x000A;  name: Reginald the Pirate</pre>
            <p>
            Each of these fixtures has two unique identifiers: one for the database and
            one for the humans. Why don&#8217;t we generate the primary key instead?
            Hashing each fixture&#8217;s label yields a consistent ID:
            </p>
            <pre>george: # generated id: 503576764&#x000A;  name: George the Monkey&#x000A;&#x000A;reginald: # generated id: 324201669&#x000A;  name: Reginald the Pirate</pre>
            <p>
            Active Record looks at the fixture&#8217;s model class, discovers the
            correct primary key, and generates it right before inserting the fixture
            into the database.
            </p>
            <p>
            The generated ID for a given label is constant, so we can discover any
            fixture&#8217;s ID without loading anything, as long as we know the label.
            </p>
            <h2>Label references for associations (belongs_to, has_one, has_many)</h2>
            <p>
            Specifying foreign keys in fixtures can be very fragile, not to mention
            difficult to read. Since Active Record can figure out the ID of any fixture
            from its label, you can specify FK&#8217;s by label instead of ID.
            </p>
            <h3>belongs_to</h3>
            <p>
            Let&#8217;s break out some more monkeys and pirates.
            </p>
            <pre>### in pirates.yml&#x000A;&#x000A;reginald:&#x000A;  id: 1&#x000A;  name: Reginald the Pirate&#x000A;  monkey_id: 1&#x000A;&#x000A;### in monkeys.yml&#x000A;&#x000A;george:&#x000A;  id: 1&#x000A;  name: George the Monkey&#x000A;  pirate_id: 1</pre>
            <p>
            Add a few more monkeys and pirates and break this into multiple files, and
            it gets pretty hard to keep track of what&#8217;s going on. Let&#8217;s use
            labels instead of IDs:
            </p>
            <pre>### in pirates.yml&#x000A;&#x000A;reginald:&#x000A;  name: Reginald the Pirate&#x000A;  monkey: george&#x000A;&#x000A;### in monkeys.yml&#x000A;&#x000A;george:&#x000A;  name: George the Monkey&#x000A;  pirate: reginald</pre>
            <p>
            Pow! All is made clear. Active Record reflects on the fixture&#8217;s model
            class, finds all the <tt>belongs_to</tt> associations, and allows you to
            specify a target <b>label</b> for the <b>association</b> (monkey: george)
            rather than a target <b>id</b> for the <b>FK</b> (<tt>monkey_id: 1</tt>).
            </p>
            <h4>Polymorphic belongs_to</h4>
            <p>
            Supporting polymorphic relationships is a little bit more complicated,
            since Active Record needs to know what type your association is pointing
            at. Something like this should look familiar:
            </p>
            <pre>### in fruit.rb&#x000A;&#x000A;belongs_to :eater, :polymorphic =&gt; true&#x000A;&#x000A;### in fruits.yml&#x000A;&#x000A;apple:&#x000A;  id: 1&#x000A;  name: apple&#x000A;  eater_id: 1&#x000A;  eater_type: Monkey</pre>
            <p>
            Can we do better? You bet!
            </p>
            <pre>apple:&#x000A;  eater: george (Monkey)</pre>
            <p>
            Just provide the polymorphic target type and Active Record will take care
            of the rest.
            </p>
            <h3>has_and_belongs_to_many</h3>
            <p>
            Time to give our monkey some fruit.
            </p>
            <pre>### in monkeys.yml&#x000A;&#x000A;george:&#x000A;  id: 1&#x000A;  name: George the Monkey&#x000A;  pirate_id: 1&#x000A;&#x000A;### in fruits.yml&#x000A;&#x000A;apple:&#x000A;  id: 1&#x000A;  name: apple&#x000A;&#x000A;orange:&#x000A;  id: 2&#x000A;  name: orange&#x000A;&#x000A;grape:&#x000A;  id: 3&#x000A;  name: grape&#x000A;&#x000A;### in fruits_monkeys.yml&#x000A;&#x000A;apple_george:&#x000A;  fruit_id: 1&#x000A;  monkey_id: 1&#x000A;&#x000A;orange_george:&#x000A;  fruit_id: 2&#x000A;  monkey_id: 1&#x000A;&#x000A;grape_george:&#x000A;  fruit_id: 3&#x000A;  monkey_id: 1</pre>
            <p>
            Let&#8217;s make the HABTM fixture go away.
            </p>
            <pre>### in monkeys.yml&#x000A;&#x000A;george:&#x000A;  name: George the Monkey&#x000A;  pirate: reginald&#x000A;  fruits: apple, orange, grape&#x000A;&#x000A;### in fruits.yml&#x000A;&#x000A;apple:&#x000A;  name: apple&#x000A;&#x000A;orange:&#x000A;  name: orange&#x000A;&#x000A;grape:&#x000A;  name: grape</pre>
            <p>
            Zap! No more fruits_monkeys.yml file. We&#8217;ve specified the list of
            fruits on George&#8217;s fixture, but we could&#8217;ve just as easily
            specified a list of monkeys on each fruit. As with <tt>belongs_to</tt>,
            Active Record reflects on the fixture&#8217;s model class and discovers the
            <tt>has_and_belongs_to_many</tt> associations.
            </p>
            <h2>Autofilled timestamp columns</h2>
            <p>
            If your table/model specifies any of Active Record&#8217;s standard
            timestamp columns (<tt>created_at</tt>, <tt>created_on</tt>,
            <tt>updated_at</tt>, <tt>updated_on</tt>), they will automatically be set
            to <tt>Time.now</tt>.
            </p>
            <p>
            If you&#8217;ve set specific values, they&#8217;ll be left alone.
            </p>
            <h2>Fixture label interpolation</h2>
            <p>
            The label of the current fixture is always available as a column value:
            </p>
            <pre>geeksomnia:&#x000A;  name: Geeksomnia's Account&#x000A;  subdomain: $LABEL</pre>
            <p>
            Also, sometimes (like when porting older join table fixtures) you&#8217;ll
            need to be able to get ahold of the identifier for a given label. <a
            href="ERB.html">ERB</a> to the rescue:
            </p>
            <pre>george_reginald:&#x000A;  monkey_id: &lt;%= Fixtures.identify(:reginald) %&gt;&#x000A;  pirate_id: &lt;%= Fixtures.identify(:george) %&gt;</pre>
            <h2>Support for YAML defaults</h2>
            <p>
            You probably already know how to use YAML to set and reuse defaults in your
            <tt>database.yml</tt> file. You can use the same technique in your
            fixtures:
            </p>
            <pre>DEFAULTS: &amp;DEFAULTS&#x000A;  created_on: &lt;%= 3.weeks.ago.to_s(:db) %&gt;&#x000A;&#x000A;first:&#x000A;  name: Smurf&#x000A;  &lt;&lt;: *DEFAULTS&#x000A;&#x000A;second:&#x000A;  name: Fraggle&#x000A;  &lt;&lt;: *DEFAULTS</pre>
            <p>
            Any fixture labeled &#8220;DEFAULTS&#8221; is safely ignored.
            </p>
          </div>
          <div id='method-list'>
            <h2>Methods</h2>
            <h3>public class</h3>
            <ol>
              <li><a href="#M000324">cache_fixtures</a></li>
              <li><a href="#M000321">cache_for_connection</a></li>
              <li><a href="#M000323">cached_fixtures</a></li>
              <li><a href="#M000327">create_fixtures</a></li>
              <li><a href="#M000322">fixture_is_cached?</a></li>
              <li><a href="#M000328">identify</a></li>
              <li><a href="#M000326">instantiate_all_loaded_fixtures</a></li>
              <li><a href="#M000325">instantiate_fixtures</a></li>
              <li><a href="#M000329">new</a></li>
              <li><a href="#M000320">reset_cache</a></li>
            </ol>
            <h3>public instance</h3>
            <ol>
              <li><a href="#M000330">delete_existing_fixtures</a></li>
              <li><a href="#M000331">insert_fixtures</a></li>
            </ol>
          </div>
          <div id='section'>
            <div id='constants-list'>
              <h2>Constants</h2>
              <div class='name-list'>
                <table summary='Constants'>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>DEFAULT_FILTER_RE</td>
                    <td>=</td>
                    <td class='context-item-value'>/\.ya?ml$/</td>
                  </tr>
                </table>
              </div>
            </div>
            <div id='attribute-list'>
              <h2 class='section-bar'>Attributes</h2>
              <div class='name-list'>
                <table>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>name</td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>table_name</td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'></td>
                  </tr>
                </table>
              </div>
            </div>
            <div id='methods'>
              <h2>Public class methods</h2>
              <div class='method public-class' id='method-M000324'>
                <a name='M000324'></a>
                <div class='synopsis'>
                  <span class='name'>cache_fixtures</span>
                  <span class='arguments'>(connection, fixtures_map)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000324-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000324-source'>     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/fixtures.rb, line 463</span>&#x000A;463:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cache_fixtures</span>(<span class="ruby-identifier">connection</span>, <span class="ruby-identifier">fixtures_map</span>)&#x000A;464:     <span class="ruby-identifier">cache_for_connection</span>(<span class="ruby-identifier">connection</span>).<span class="ruby-identifier">update</span>(<span class="ruby-identifier">fixtures_map</span>)&#x000A;465:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-class' id='method-M000321'>
                <a name='M000321'></a>
                <div class='synopsis'>
                  <span class='name'>cache_for_connection</span>
                  <span class='arguments'>(connection)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000321-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000321-source'>     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/fixtures.rb, line 445</span>&#x000A;445:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cache_for_connection</span>(<span class="ruby-identifier">connection</span>)&#x000A;446:     <span class="ruby-ivar">@@all_cached_fixtures</span>[<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">object_id</span>] <span class="ruby-operator">||=</span> {}&#x000A;447:     <span class="ruby-ivar">@@all_cached_fixtures</span>[<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">object_id</span>]&#x000A;448:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-class' id='method-M000323'>
                <a name='M000323'></a>
                <div class='synopsis'>
                  <span class='name'>cached_fixtures</span>
                  <span class='arguments'>(connection, keys_to_fetch = nil)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000323-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000323-source'>     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/fixtures.rb, line 454</span>&#x000A;454:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cached_fixtures</span>(<span class="ruby-identifier">connection</span>, <span class="ruby-identifier">keys_to_fetch</span> = <span class="ruby-keyword kw">nil</span>)&#x000A;455:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">keys_to_fetch</span>&#x000A;456:       <span class="ruby-identifier">fixtures</span> = <span class="ruby-identifier">cache_for_connection</span>(<span class="ruby-identifier">connection</span>).<span class="ruby-identifier">values_at</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">keys_to_fetch</span>)&#x000A;457:     <span class="ruby-keyword kw">else</span>&#x000A;458:       <span class="ruby-identifier">fixtures</span> = <span class="ruby-identifier">cache_for_connection</span>(<span class="ruby-identifier">connection</span>).<span class="ruby-identifier">values</span>&#x000A;459:     <span class="ruby-keyword kw">end</span>&#x000A;460:     <span class="ruby-identifier">fixtures</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">fixtures</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">fixtures</span>.<span class="ruby-identifier">first</span>&#x000A;461:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-class' id='method-M000327'>
                <a name='M000327'></a>
                <div class='synopsis'>
                  <span class='name'>create_fixtures</span>
                  <span class='arguments'>(fixtures_directory, table_names, class_names = {}) {|: ActiveRecord::Base.connection| ...}</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000327-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000327-source'>     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/fixtures.rb, line 491</span>&#x000A;491:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">create_fixtures</span>(<span class="ruby-identifier">fixtures_directory</span>, <span class="ruby-identifier">table_names</span>, <span class="ruby-identifier">class_names</span> = {})&#x000A;492:     <span class="ruby-identifier">table_names</span> = [<span class="ruby-identifier">table_names</span>].<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">n</span><span class="ruby-operator">|</span> <span class="ruby-identifier">n</span>.<span class="ruby-identifier">to_s</span> }&#x000A;493:     <span class="ruby-identifier">connection</span>  = <span class="ruby-identifier">block_given?</span> <span class="ruby-value">? </span><span class="ruby-keyword kw">yield</span> <span class="ruby-operator">:</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>&#x000A;494: &#x000A;495:     <span class="ruby-identifier">table_names_to_fetch</span> = <span class="ruby-identifier">table_names</span>.<span class="ruby-identifier">reject</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">table_name</span><span class="ruby-operator">|</span> <span class="ruby-identifier">fixture_is_cached?</span>(<span class="ruby-identifier">connection</span>, <span class="ruby-identifier">table_name</span>) }&#x000A;496: &#x000A;497:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">table_names_to_fetch</span>.<span class="ruby-identifier">empty?</span>&#x000A;498:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">silence</span> <span class="ruby-keyword kw">do</span>&#x000A;499:         <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">disable_referential_integrity</span> <span class="ruby-keyword kw">do</span>&#x000A;500:           <span class="ruby-identifier">fixtures_map</span> = {}&#x000A;501: &#x000A;502:           <span class="ruby-identifier">fixtures</span> = <span class="ruby-identifier">table_names_to_fetch</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">table_name</span><span class="ruby-operator">|</span>&#x000A;503:             <span class="ruby-identifier">fixtures_map</span>[<span class="ruby-identifier">table_name</span>] = <span class="ruby-constant">Fixtures</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">connection</span>, <span class="ruby-constant">File</span>.<span class="ruby-identifier">split</span>(<span class="ruby-identifier">table_name</span>.<span class="ruby-identifier">to_s</span>).<span class="ruby-identifier">last</span>, <span class="ruby-identifier">class_names</span>[<span class="ruby-identifier">table_name</span>.<span class="ruby-identifier">to_sym</span>], <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">fixtures_directory</span>, <span class="ruby-identifier">table_name</span>.<span class="ruby-identifier">to_s</span>))&#x000A;504:           <span class="ruby-keyword kw">end</span>&#x000A;505: &#x000A;506:           <span class="ruby-identifier">all_loaded_fixtures</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">fixtures_map</span>)&#x000A;507: &#x000A;508:           <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">transaction</span>(<span class="ruby-identifier">:requires_new</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>) <span class="ruby-keyword kw">do</span>&#x000A;509:             <span class="ruby-identifier">fixtures</span>.<span class="ruby-identifier">reverse</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">fixture</span><span class="ruby-operator">|</span> <span class="ruby-identifier">fixture</span>.<span class="ruby-identifier">delete_existing_fixtures</span> }&#x000A;510:             <span class="ruby-identifier">fixtures</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">fixture</span><span class="ruby-operator">|</span> <span class="ruby-identifier">fixture</span>.<span class="ruby-identifier">insert_fixtures</span> }&#x000A;511: &#x000A;512:             <span class="ruby-comment cmt"># Cap primary key sequences to max(pk).</span>&#x000A;513:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:reset_pk_sequence!</span>)&#x000A;514:               <span class="ruby-identifier">table_names</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">table_name</span><span class="ruby-operator">|</span>&#x000A;515:                 <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">reset_pk_sequence!</span>(<span class="ruby-identifier">table_name</span>)&#x000A;516:               <span class="ruby-keyword kw">end</span>&#x000A;517:             <span class="ruby-keyword kw">end</span>&#x000A;518:           <span class="ruby-keyword kw">end</span>&#x000A;519: &#x000A;520:           <span class="ruby-identifier">cache_fixtures</span>(<span class="ruby-identifier">connection</span>, <span class="ruby-identifier">fixtures_map</span>)&#x000A;521:         <span class="ruby-keyword kw">end</span>&#x000A;522:       <span class="ruby-keyword kw">end</span>&#x000A;523:     <span class="ruby-keyword kw">end</span>&#x000A;524:     <span class="ruby-identifier">cached_fixtures</span>(<span class="ruby-identifier">connection</span>, <span class="ruby-identifier">table_names</span>)&#x000A;525:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-class' id='method-M000322'>
                <a name='M000322'></a>
                <div class='synopsis'>
                  <span class='name'>fixture_is_cached?</span>
                  <span class='arguments'>(connection, table_name)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000322-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000322-source'>     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/fixtures.rb, line 450</span>&#x000A;450:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">fixture_is_cached?</span>(<span class="ruby-identifier">connection</span>, <span class="ruby-identifier">table_name</span>)&#x000A;451:     <span class="ruby-identifier">cache_for_connection</span>(<span class="ruby-identifier">connection</span>)[<span class="ruby-identifier">table_name</span>]&#x000A;452:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-class' id='method-M000328'>
                <a name='M000328'></a>
                <div class='synopsis'>
                  <span class='name'>identify</span>
                  <span class='arguments'>(label)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns a consistent identifier for <tt>label</tt>. This will always be a
                  positive integer, and will always be the same for a given label, assuming
                  the same OS, platform, and version of Ruby.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000328-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000328-source'>     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/fixtures.rb, line 530</span>&#x000A;530:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">identify</span>(<span class="ruby-identifier">label</span>)&#x000A;531:     <span class="ruby-identifier">label</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">hash</span>.<span class="ruby-identifier">abs</span>&#x000A;532:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-class' id='method-M000326'>
                <a name='M000326'></a>
                <div class='synopsis'>
                  <span class='name'>instantiate_all_loaded_fixtures</span>
                  <span class='arguments'>(object, load_instances = true)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000326-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000326-source'>     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/fixtures.rb, line 482</span>&#x000A;482:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">instantiate_all_loaded_fixtures</span>(<span class="ruby-identifier">object</span>, <span class="ruby-identifier">load_instances</span> = <span class="ruby-keyword kw">true</span>)&#x000A;483:     <span class="ruby-identifier">all_loaded_fixtures</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">table_name</span>, <span class="ruby-identifier">fixtures</span><span class="ruby-operator">|</span>&#x000A;484:       <span class="ruby-constant">Fixtures</span>.<span class="ruby-identifier">instantiate_fixtures</span>(<span class="ruby-identifier">object</span>, <span class="ruby-identifier">table_name</span>, <span class="ruby-identifier">fixtures</span>, <span class="ruby-identifier">load_instances</span>)&#x000A;485:     <span class="ruby-keyword kw">end</span>&#x000A;486:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-class' id='method-M000325'>
                <a name='M000325'></a>
                <div class='synopsis'>
                  <span class='name'>instantiate_fixtures</span>
                  <span class='arguments'>(object, table_name, fixtures, load_instances = true)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000325-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000325-source'>     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/fixtures.rb, line 467</span>&#x000A;467:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">instantiate_fixtures</span>(<span class="ruby-identifier">object</span>, <span class="ruby-identifier">table_name</span>, <span class="ruby-identifier">fixtures</span>, <span class="ruby-identifier">load_instances</span> = <span class="ruby-keyword kw">true</span>)&#x000A;468:     <span class="ruby-identifier">object</span>.<span class="ruby-identifier">instance_variable_set</span> <span class="ruby-node">&quot;@#{table_name.to_s.gsub('.','_')}&quot;</span>, <span class="ruby-identifier">fixtures</span>&#x000A;469:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">load_instances</span>&#x000A;470:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">silence</span> <span class="ruby-keyword kw">do</span>&#x000A;471:         <span class="ruby-identifier">fixtures</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">fixture</span><span class="ruby-operator">|</span>&#x000A;472:           <span class="ruby-keyword kw">begin</span>&#x000A;473:             <span class="ruby-identifier">object</span>.<span class="ruby-identifier">instance_variable_set</span> <span class="ruby-node">&quot;@#{name}&quot;</span>, <span class="ruby-identifier">fixture</span>.<span class="ruby-identifier">find</span>&#x000A;474:           <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">FixtureClassNotFound</span>&#x000A;475:             <span class="ruby-keyword kw">nil</span>&#x000A;476:           <span class="ruby-keyword kw">end</span>&#x000A;477:         <span class="ruby-keyword kw">end</span>&#x000A;478:       <span class="ruby-keyword kw">end</span>&#x000A;479:     <span class="ruby-keyword kw">end</span>&#x000A;480:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-class' id='method-M000329'>
                <a name='M000329'></a>
                <div class='synopsis'>
                  <span class='name'>new</span>
                  <span class='arguments'>(connection, table_name, class_name, fixture_path, file_filter = DEFAULT_FILTER_RE)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000329-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000329-source'>     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/fixtures.rb, line 536</span>&#x000A;536:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">connection</span>, <span class="ruby-identifier">table_name</span>, <span class="ruby-identifier">class_name</span>, <span class="ruby-identifier">fixture_path</span>, <span class="ruby-identifier">file_filter</span> = <span class="ruby-constant">DEFAULT_FILTER_RE</span>)&#x000A;537:     <span class="ruby-ivar">@connection</span>, <span class="ruby-ivar">@table_name</span>, <span class="ruby-ivar">@fixture_path</span>, <span class="ruby-ivar">@file_filter</span> = <span class="ruby-identifier">connection</span>, <span class="ruby-identifier">table_name</span>, <span class="ruby-identifier">fixture_path</span>, <span class="ruby-identifier">file_filter</span>&#x000A;538:     <span class="ruby-ivar">@name</span> = <span class="ruby-identifier">table_name</span> <span class="ruby-comment cmt"># preserve fixture base name</span>&#x000A;539:     <span class="ruby-ivar">@class_name</span> = <span class="ruby-identifier">class_name</span> <span class="ruby-operator">||</span>&#x000A;540:                   (<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">pluralize_table_names</span> <span class="ruby-value">? </span><span class="ruby-ivar">@table_name</span>.<span class="ruby-identifier">singularize</span>.<span class="ruby-identifier">camelize</span> <span class="ruby-operator">:</span> <span class="ruby-ivar">@table_name</span>.<span class="ruby-identifier">camelize</span>)&#x000A;541:     <span class="ruby-ivar">@table_name</span> = <span class="ruby-node">&quot;#{ActiveRecord::Base.table_name_prefix}#{@table_name}#{ActiveRecord::Base.table_name_suffix}&quot;</span>&#x000A;542:     <span class="ruby-ivar">@table_name</span> = <span class="ruby-identifier">class_name</span>.<span class="ruby-identifier">table_name</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">class_name</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:table_name</span>)&#x000A;543:     <span class="ruby-ivar">@connection</span> = <span class="ruby-identifier">class_name</span>.<span class="ruby-identifier">connection</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">class_name</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:connection</span>)&#x000A;544:     <span class="ruby-identifier">read_fixture_files</span>&#x000A;545:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-class' id='method-M000320'>
                <a name='M000320'></a>
                <div class='synopsis'>
                  <span class='name'>reset_cache</span>
                  <span class='arguments'>(connection = nil)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000320-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000320-source'>     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/fixtures.rb, line 440</span>&#x000A;440:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">reset_cache</span>(<span class="ruby-identifier">connection</span> = <span class="ruby-keyword kw">nil</span>)&#x000A;441:     <span class="ruby-identifier">connection</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>&#x000A;442:     <span class="ruby-ivar">@@all_cached_fixtures</span>[<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">object_id</span>] = {}&#x000A;443:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <h2>Public instance methods</h2>
              <div class='method public-instance' id='method-M000330'>
                <a name='M000330'></a>
                <div class='synopsis'>
                  <span class='name'>delete_existing_fixtures</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000330-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000330-source'>     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/fixtures.rb, line 547</span>&#x000A;547:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete_existing_fixtures</span>&#x000A;548:     <span class="ruby-ivar">@connection</span>.<span class="ruby-identifier">delete</span> <span class="ruby-node">&quot;DELETE FROM #{@connection.quote_table_name(table_name)}&quot;</span>, <span class="ruby-value str">'Fixture Delete'</span>&#x000A;549:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000331'>
                <a name='M000331'></a>
                <div class='synopsis'>
                  <span class='name'>insert_fixtures</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000331-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000331-source'>     <span class="ruby-comment cmt"># File vendor/rails/activerecord/lib/active_record/fixtures.rb, line 551</span>&#x000A;551:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">insert_fixtures</span>&#x000A;552:     <span class="ruby-identifier">now</span> = <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">default_timezone</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:utc</span> <span class="ruby-operator">?</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">utc</span> <span class="ruby-operator">:</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>&#x000A;553:     <span class="ruby-identifier">now</span> = <span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_s</span>(<span class="ruby-identifier">:db</span>)&#x000A;554: &#x000A;555:     <span class="ruby-comment cmt"># allow a standard key to be used for doing defaults in YAML</span>&#x000A;556:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>)&#x000A;557:       <span class="ruby-identifier">delete</span>(<span class="ruby-value str">'DEFAULTS'</span>)&#x000A;558:     <span class="ruby-keyword kw">else</span>&#x000A;559:       <span class="ruby-identifier">delete</span>(<span class="ruby-identifier">assoc</span>(<span class="ruby-value str">'DEFAULTS'</span>))&#x000A;560:     <span class="ruby-keyword kw">end</span>&#x000A;561: &#x000A;562:     <span class="ruby-comment cmt"># track any join tables we need to insert later</span>&#x000A;563:     <span class="ruby-identifier">habtm_fixtures</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">h</span>, <span class="ruby-identifier">habtm</span><span class="ruby-operator">|</span>&#x000A;564:       <span class="ruby-identifier">h</span>[<span class="ruby-identifier">habtm</span>] = <span class="ruby-constant">HabtmFixtures</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@connection</span>, <span class="ruby-identifier">habtm</span>.<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:join_table</span>], <span class="ruby-keyword kw">nil</span>, <span class="ruby-keyword kw">nil</span>)&#x000A;565:     <span class="ruby-keyword kw">end</span>&#x000A;566: &#x000A;567:     <span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">label</span>, <span class="ruby-identifier">fixture</span><span class="ruby-operator">|</span>&#x000A;568:       <span class="ruby-identifier">row</span> = <span class="ruby-identifier">fixture</span>.<span class="ruby-identifier">to_hash</span>&#x000A;569: &#x000A;570:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">model_class</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">model_class</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>&#x000A;571:         <span class="ruby-comment cmt"># fill in timestamp columns if they aren't specified and the model is set to record_timestamps</span>&#x000A;572:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">model_class</span>.<span class="ruby-identifier">record_timestamps</span>&#x000A;573:           <span class="ruby-identifier">timestamp_column_names</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span><span class="ruby-operator">|</span>&#x000A;574:             <span class="ruby-identifier">row</span>[<span class="ruby-identifier">name</span>] = <span class="ruby-identifier">now</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">row</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-identifier">name</span>)&#x000A;575:           <span class="ruby-keyword kw">end</span>&#x000A;576:         <span class="ruby-keyword kw">end</span>&#x000A;577: &#x000A;578:         <span class="ruby-comment cmt"># interpolate the fixture label</span>&#x000A;579:         <span class="ruby-identifier">row</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>&#x000A;580:           <span class="ruby-identifier">row</span>[<span class="ruby-identifier">key</span>] = <span class="ruby-identifier">label</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;$LABEL&quot;</span>&#x000A;581:         <span class="ruby-keyword kw">end</span>&#x000A;582: &#x000A;583:         <span class="ruby-comment cmt"># generate a primary key if necessary</span>&#x000A;584:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">has_primary_key_column?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">row</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">primary_key_name</span>)&#x000A;585:           <span class="ruby-identifier">row</span>[<span class="ruby-identifier">primary_key_name</span>] = <span class="ruby-constant">Fixtures</span>.<span class="ruby-identifier">identify</span>(<span class="ruby-identifier">label</span>)&#x000A;586:         <span class="ruby-keyword kw">end</span>&#x000A;587: &#x000A;588:         <span class="ruby-comment cmt"># If STI is used, find the correct subclass for association reflection</span>&#x000A;589:         <span class="ruby-identifier">reflection_class</span> =&#x000A;590:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">row</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">inheritance_column_name</span>)&#x000A;591:             <span class="ruby-identifier">row</span>[<span class="ruby-identifier">inheritance_column_name</span>].<span class="ruby-identifier">constantize</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-identifier">model_class</span>&#x000A;592:           <span class="ruby-keyword kw">else</span>&#x000A;593:             <span class="ruby-identifier">model_class</span>&#x000A;594:           <span class="ruby-keyword kw">end</span>&#x000A;595: &#x000A;596:         <span class="ruby-identifier">reflection_class</span>.<span class="ruby-identifier">reflect_on_all_associations</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">association</span><span class="ruby-operator">|</span>&#x000A;597:           <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">association</span>.<span class="ruby-identifier">macro</span>&#x000A;598:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:belongs_to</span>&#x000A;599:             <span class="ruby-comment cmt"># Do not replace association name with association foreign key if they are named the same</span>&#x000A;600:             <span class="ruby-identifier">fk_name</span> = (<span class="ruby-identifier">association</span>.<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:foreign_key</span>] <span class="ruby-operator">||</span> <span class="ruby-node">&quot;#{association.name}_id&quot;</span>).<span class="ruby-identifier">to_s</span>&#x000A;601: &#x000A;602:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">association</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">fk_name</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">value</span> = <span class="ruby-identifier">row</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">association</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>)&#x000A;603:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">association</span>.<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:polymorphic</span>]&#x000A;604:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-regexp re">/\s*\(([^\)]*)\)\s*$/</span>, <span class="ruby-value str">&quot;&quot;</span>)&#x000A;605:                   <span class="ruby-identifier">target_type</span> = <span class="ruby-identifier">$1</span>&#x000A;606:                   <span class="ruby-identifier">target_type_name</span> = (<span class="ruby-identifier">association</span>.<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:foreign_type</span>] <span class="ruby-operator">||</span> <span class="ruby-node">&quot;#{association.name}_type&quot;</span>).<span class="ruby-identifier">to_s</span>&#x000A;607: &#x000A;608:                   <span class="ruby-comment cmt"># support polymorphic belongs_to as &quot;label (Type)&quot;</span>&#x000A;609:                   <span class="ruby-identifier">row</span>[<span class="ruby-identifier">target_type_name</span>] = <span class="ruby-identifier">target_type</span>&#x000A;610:                 <span class="ruby-keyword kw">end</span>&#x000A;611:               <span class="ruby-keyword kw">end</span>&#x000A;612: &#x000A;613:               <span class="ruby-identifier">row</span>[<span class="ruby-identifier">fk_name</span>] = <span class="ruby-constant">Fixtures</span>.<span class="ruby-identifier">identify</span>(<span class="ruby-identifier">value</span>)&#x000A;614:             <span class="ruby-keyword kw">end</span>&#x000A;615:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:has_and_belongs_to_many</span>&#x000A;616:             <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">targets</span> = <span class="ruby-identifier">row</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">association</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>))&#x000A;617:               <span class="ruby-identifier">targets</span> = <span class="ruby-identifier">targets</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">targets</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">targets</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/\s*,\s*/</span>)&#x000A;618:               <span class="ruby-identifier">join_fixtures</span> = <span class="ruby-identifier">habtm_fixtures</span>[<span class="ruby-identifier">association</span>]&#x000A;619: &#x000A;620:               <span class="ruby-identifier">targets</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">target</span><span class="ruby-operator">|</span>&#x000A;621:                 <span class="ruby-identifier">join_fixtures</span>[<span class="ruby-node">&quot;#{label}_#{target}&quot;</span>] = <span class="ruby-constant">Fixture</span>.<span class="ruby-identifier">new</span>(&#x000A;622:                   { <span class="ruby-identifier">association</span>.<span class="ruby-identifier">primary_key_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">row</span>[<span class="ruby-identifier">primary_key_name</span>],&#x000A;623:                     <span class="ruby-identifier">association</span>.<span class="ruby-identifier">association_foreign_key</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Fixtures</span>.<span class="ruby-identifier">identify</span>(<span class="ruby-identifier">target</span>) }, <span class="ruby-keyword kw">nil</span>)&#x000A;624:               <span class="ruby-keyword kw">end</span>&#x000A;625:             <span class="ruby-keyword kw">end</span>&#x000A;626:           <span class="ruby-keyword kw">end</span>&#x000A;627:         <span class="ruby-keyword kw">end</span>&#x000A;628:       <span class="ruby-keyword kw">end</span>&#x000A;629: &#x000A;630:       <span class="ruby-ivar">@connection</span>.<span class="ruby-identifier">insert_fixture</span>(<span class="ruby-identifier">fixture</span>, <span class="ruby-ivar">@table_name</span>)&#x000A;631:     <span class="ruby-keyword kw">end</span>&#x000A;632: &#x000A;633:     <span class="ruby-comment cmt"># insert any HABTM join tables we discovered</span>&#x000A;634:     <span class="ruby-identifier">habtm_fixtures</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">fixture</span><span class="ruby-operator">|</span>&#x000A;635:       <span class="ruby-identifier">fixture</span>.<span class="ruby-identifier">delete_existing_fixtures</span>&#x000A;636:       <span class="ruby-identifier">fixture</span>.<span class="ruby-identifier">insert_fixtures</span>&#x000A;637:     <span class="ruby-keyword kw">end</span>&#x000A;638:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
